[
  {
    "id": "M1-code",
    "name": "Lima socket parity (code)",
    "type": "code",
    "phase": "M1",
    "status": "in_progress",
    "description": "Replace/re-provision Lima with the socket-activated world-agent layout, ensure the agent binary + units + socket perms are installed/healthy, and make warm/provision idempotent.",
    "references": [
      "docs/project_management/next/p0-platform-stability-macOS-parity/plan.md",
      "docs/project_management/next/p0-platform-stability-macOS-parity/M1-spec.md",
      "docs/project_management/next/p0-platform-stability/plan.md",
      "docs/project_management/next/p0-platform-stability/manual_testing_playbook.md"
    ],
    "acceptance_criteria": [
      "Warm/provision flow replaces any existing Lima environment with socket-activated world-agent units and an installed agent binary.",
      "Socket ownership/permissions align with the documented mac model and allow SSH user access via group/forwarding.",
      "Lima provisioning ensures `SocketGroup=substrate`, adds the user to the substrate group (or documented equivalent), and carries linger guidance so socket activation persists post-login.",
      "Provisioning can be re-run idempotently (including tearing down/recreating the VM) and emits actionable errors when prerequisites are missing.",
      "Doctor/logging surfaces provisioning status and next steps."
    ],
    "start_checklist": [
      "git checkout feat/p0-platform-stability-macOS-parity && git pull --ff-only",
      "Read plan, tasks.json, session_log.md, M1-spec.md, kickoff prompt",
      "Set task status to in_progress in tasks.json (orchestration branch)",
      "Add START entry to session_log.md; commit docs with message 'docs: start M1-code'",
      "Create branch mp-m1-sockets-code from feat/p0-platform-stability-macOS-parity; run `git worktree add wt/mp-m1-sockets-code mp-m1-sockets-code`.",
      "Do not edit docs/tasks/session_log.md from the worktree."
    ],
    "end_checklist": [
      "Run required commands (capture outputs): cargo fmt; cargo clippy --workspace --all-targets -- -D warnings.",
      "Inside wt/mp-m1-sockets-code, commit M1-code changes to branch mp-m1-sockets-code (no docs/tasks/session_log edits).",
      "Outside the worktree, ensure branch mp-m1-sockets-code contains the new commit (fast-forward if needed); do not merge into feat/p0-platform-stability-macOS-parity.",
      "Checkout feat/p0-platform-stability-macOS-parity; update tasks.json to completed; add an END entry to session_log.md with commands/results/blockers; create downstream prompts if missing; commit docs with 'docs: finish M1-code'.",
      "Remove worktree wt/mp-m1-sockets-code."
    ],
    "worktree": "wt/mp-m1-sockets-code",
    "integration_task": "M1-integ",
    "kickoff_prompt": "docs/project_management/next/p0-platform-stability-macOS-parity/kickoff_prompts/M1-code.md",
    "depends_on": [],
    "concurrent_with": [
      "M1-test"
    ]
  },
  {
    "id": "M1-test",
    "name": "Lima socket parity (test)",
    "type": "test",
    "phase": "M1",
    "status": "in_progress",
    "description": "Add tests/fixtures/harnesses validating mac Lima socket parity replacement/provisioning per M1-spec.",
    "references": [
      "docs/project_management/next/p0-platform-stability-macOS-parity/plan.md",
      "docs/project_management/next/p0-platform-stability-macOS-parity/M1-spec.md",
      "docs/project_management/next/p0-platform-stability/manual_testing_playbook.md"
    ],
    "acceptance_criteria": [
      "Tests cover replacement/provisioning detection/remediation logic and socket state reporting where platform-agnostic.",
      "Fixtures/log harnesses capture doctor/provisioning outputs for verification (including rebuild-required states).",
      "Required commands executed (fmt + targeted tests) and recorded in session_log.md.",
      "No production code changes."
    ],
    "start_checklist": [
      "git checkout feat/p0-platform-stability-macOS-parity && git pull --ff-only",
      "Read plan, tasks.json, session_log.md, M1-spec.md, kickoff prompt",
      "Set task status to in_progress in tasks.json (orchestration branch)",
      "Add START entry to session_log.md; commit docs with message 'docs: start M1-test'",
      "Create branch mp-m1-sockets-test from feat/p0-platform-stability-macOS-parity; run `git worktree add wt/mp-m1-sockets-test mp-m1-sockets-test`.",
      "Do not edit docs/tasks/session_log.md from the worktree."
    ],
    "end_checklist": [
      "Run required commands (capture outputs): cargo fmt; targeted cargo test commands for suites added/updated.",
      "Inside wt/mp-m1-sockets-test, commit M1-test changes to branch mp-m1-sockets-test (no docs/tasks/session_log edits).",
      "Outside the worktree, ensure branch mp-m1-sockets-test contains the new commit (fast-forward if needed); do not merge into feat/p0-platform-stability-macOS-parity.",
      "Checkout feat/p0-platform-stability-macOS-parity; update tasks.json to completed; add an END entry to session_log.md with commands/results/blockers; create downstream prompts if missing; commit docs with 'docs: finish M1-test'.",
      "Remove worktree wt/mp-m1-sockets-test."
    ],
    "worktree": "wt/mp-m1-sockets-test",
    "integration_task": "M1-integ",
    "kickoff_prompt": "docs/project_management/next/p0-platform-stability-macOS-parity/kickoff_prompts/M1-test.md",
    "depends_on": [],
    "concurrent_with": [
      "M1-code"
    ]
  },
  {
    "id": "M1-integ",
    "name": "Lima socket parity (integration)",
    "type": "integration",
    "phase": "M1",
    "status": "pending",
    "description": "Merge M1 code/test, reconcile to spec, and ensure mac socket parity replacement/provisioning is green.",
    "references": [
      "docs/project_management/next/p0-platform-stability-macOS-parity/plan.md",
      "docs/project_management/next/p0-platform-stability-macOS-parity/M1-spec.md",
      "docs/project_management/next/p0-platform-stability/manual_testing_playbook.md"
    ],
    "acceptance_criteria": [
      "Code + tests merged and aligned to M1-spec.",
      "cargo fmt + clippy + relevant tests + make preflight executed and logged.",
      "Integration branch merged fast-forward into orchestration; tasks/logs updated."
    ],
    "start_checklist": [
      "git checkout feat/p0-platform-stability-macOS-parity && git pull --ff-only",
      "Read plan, tasks.json, session_log.md, M1-spec.md, kickoff prompt",
      "Set task status to in_progress in tasks.json (orchestration branch)",
      "Add START entry to session_log.md; commit docs with message 'docs: start M1-integ'",
      "Create branch mp-m1-sockets-integ from feat/p0-platform-stability-macOS-parity; run `git worktree add wt/mp-m1-sockets-integ mp-m1-sockets-integ`.",
      "Do not edit docs/tasks/session_log.md from the worktree."
    ],
    "end_checklist": [
      "Merge upstream code/test branches for M1 into mp-m1-sockets-integ inside wt/mp-m1-sockets-integ and reconcile behavior to the spec.",
      "Run required commands (capture outputs): cargo fmt; cargo clippy --workspace --all-targets -- -D warnings; relevant tests; make preflight.",
      "Commit integration changes on branch mp-m1-sockets-integ.",
      "Fast-forward merge mp-m1-sockets-integ into feat/p0-platform-stability-macOS-parity; update tasks.json to completed; add an END entry to session_log.md with commands/results/blockers; commit docs with 'docs: finish M1-integ'.",
      "Remove worktree wt/mp-m1-sockets-integ."
    ],
    "worktree": "wt/mp-m1-sockets-integ",
    "integration_task": "M1-integ",
    "kickoff_prompt": "docs/project_management/next/p0-platform-stability-macOS-parity/kickoff_prompts/M1-integ.md",
    "depends_on": [
      "M1-code",
      "M1-test"
    ],
    "concurrent_with": []
  },
  {
    "id": "M2-code",
    "name": "Installer parity (macOS) \u2013 code",
    "type": "code",
    "phase": "M2",
    "status": "pending",
    "description": "Align mac dev/prod installers with Linux parity: build/copy agent/CLI in Lima when missing, honor cleanup-state metadata, and keep uninstall parity.",
    "references": [
      "docs/project_management/next/p0-platform-stability-macOS-parity/plan.md",
      "docs/project_management/next/p0-platform-stability-macOS-parity/M2-spec.md",
      "docs/project_management/next/p0-platform-stability/plan.md"
    ],
    "acceptance_criteria": [
      "Dev/prod mac installers install a usable agent even when no Linux binary is bundled (build-in-VM fallback or explicit fail with guidance).",
      "Prod path copies a valid bundled Linux agent into Lima; in-guest build occurs only as a logged fallback when the bundle is missing/invalid.",
      "Dev path may build in-guest; logging distinguishes copy vs build flows.",
      "Optional CLI shim behavior is consistent across dev/prod and documented.",
      "Cleanup-state and metadata handling mirror Linux semantics; uninstall removes guest/host artifacts accordingly.",
      "Logs clearly differentiate copy vs build flows and surface actionable errors."
    ],
    "start_checklist": [
      "git checkout feat/p0-platform-stability-macOS-parity && git pull --ff-only",
      "Read plan, tasks.json, session_log.md, M2-spec.md, kickoff prompt",
      "Set task status to in_progress in tasks.json (orchestration branch)",
      "Add START entry to session_log.md; commit docs with message 'docs: start M2-code'",
      "Create branch mp-m2-installer-code from feat/p0-platform-stability-macOS-parity; run `git worktree add wt/mp-m2-installer-code mp-m2-installer-code`.",
      "Do not edit docs/tasks/session_log.md from the worktree."
    ],
    "end_checklist": [
      "Run required commands (capture outputs): cargo fmt; cargo clippy --workspace --all-targets -- -D warnings.",
      "Inside wt/mp-m2-installer-code, commit M2-code changes to branch mp-m2-installer-code (no docs/tasks/session_log edits).",
      "Outside the worktree, ensure branch mp-m2-installer-code contains the new commit (fast-forward if needed); do not merge into feat/p0-platform-stability-macOS-parity.",
      "Checkout feat/p0-platform-stability-macOS-parity; update tasks.json to completed; add an END entry to session_log.md with commands/results/blockers; create downstream prompts if missing; commit docs with 'docs: finish M2-code'.",
      "Remove worktree wt/mp-m2-installer-code."
    ],
    "worktree": "wt/mp-m2-installer-code",
    "integration_task": "M2-integ",
    "kickoff_prompt": "docs/project_management/next/p0-platform-stability-macOS-parity/kickoff_prompts/M2-code.md",
    "depends_on": [
      "M1-integ"
    ],
    "concurrent_with": [
      "M2-test"
    ]
  },
  {
    "id": "M2-test",
    "name": "Installer parity (macOS) \u2013 test",
    "type": "test",
    "phase": "M2",
    "status": "pending",
    "description": "Add tests/harnesses covering mac installer/uninstaller parity (build-in-VM fallback, cleanup-state, metadata) per M2-spec.",
    "references": [
      "docs/project_management/next/p0-platform-stability-macOS-parity/plan.md",
      "docs/project_management/next/p0-platform-stability-macOS-parity/M2-spec.md"
    ],
    "acceptance_criteria": [
      "Tests validate mac install/uninstall flows including missing-agent fallback and cleanup-state metadata where platform-agnostic.",
      "Coverage includes prod copy-first path vs build fallback (document skips where platform-specific).",
      "Harness captures logs/outputs for guidance verification.",
      "Required commands executed (fmt + targeted tests) and recorded in session_log.md.",
      "No production code changes."
    ],
    "start_checklist": [
      "git checkout feat/p0-platform-stability-macOS-parity && git pull --ff-only",
      "Read plan, tasks.json, session_log.md, M2-spec.md, kickoff prompt",
      "Set task status to in_progress in tasks.json (orchestration branch)",
      "Add START entry to session_log.md; commit docs with message 'docs: start M2-test'",
      "Create branch mp-m2-installer-test from feat/p0-platform-stability-macOS-parity; run `git worktree add wt/mp-m2-installer-test mp-m2-installer-test`.",
      "Do not edit docs/tasks/session_log.md from the worktree."
    ],
    "end_checklist": [
      "Run required commands (capture outputs): cargo fmt; targeted cargo test commands for suites added/updated.",
      "Inside wt/mp-m2-installer-test, commit M2-test changes to branch mp-m2-installer-test (no docs/tasks/session_log edits).",
      "Outside the worktree, ensure branch mp-m2-installer-test contains the new commit (fast-forward if needed); do not merge into feat/p0-platform-stability-macOS-parity.",
      "Checkout feat/p0-platform-stability-macOS-parity; update tasks.json to completed; add an END entry to session_log.md with commands/results/blockers; create downstream prompts if missing; commit docs with 'docs: finish M2-test'.",
      "Remove worktree wt/mp-m2-installer-test."
    ],
    "worktree": "wt/mp-m2-installer-test",
    "integration_task": "M2-integ",
    "kickoff_prompt": "docs/project_management/next/p0-platform-stability-macOS-parity/kickoff_prompts/M2-test.md",
    "depends_on": [
      "M1-integ"
    ],
    "concurrent_with": [
      "M2-code"
    ]
  },
  {
    "id": "M2-integ",
    "name": "Installer parity (macOS) \u2013 integration",
    "type": "integration",
    "phase": "M2",
    "status": "pending",
    "description": "Merge M2 code/test, align mac installer/uninstaller parity with spec, and gate with fmt/clippy/tests/make preflight.",
    "references": [
      "docs/project_management/next/p0-platform-stability-macOS-parity/plan.md",
      "docs/project_management/next/p0-platform-stability-macOS-parity/M2-spec.md"
    ],
    "acceptance_criteria": [
      "Installer parity changes merged and match M2-spec (dev/prod mac).",
      "cargo fmt + clippy + relevant tests + make preflight executed and logged.",
      "Integration merged fast-forward; tasks/logs updated."
    ],
    "start_checklist": [
      "git checkout feat/p0-platform-stability-macOS-parity && git pull --ff-only",
      "Read plan, tasks.json, session_log.md, M2-spec.md, kickoff prompt",
      "Set task status to in_progress in tasks.json (orchestration branch)",
      "Add START entry to session_log.md; commit docs with message 'docs: start M2-integ'",
      "Create branch mp-m2-installer-integ from feat/p0-platform-stability-macOS-parity; run `git worktree add wt/mp-m2-installer-integ mp-m2-installer-integ`.",
      "Do not edit docs/tasks/session_log.md from the worktree."
    ],
    "end_checklist": [
      "Merge upstream code/test branches for M2 into mp-m2-installer-integ inside wt/mp-m2-installer-integ and reconcile behavior to the spec.",
      "Run required commands (capture outputs): cargo fmt; cargo clippy --workspace --all-targets -- -D warnings; relevant tests; make preflight.",
      "Commit integration changes on branch mp-m2-installer-integ.",
      "Fast-forward merge mp-m2-installer-integ into feat/p0-platform-stability-macOS-parity; update tasks.json to completed; add an END entry to session_log.md with commands/results/blockers; commit docs with 'docs: finish M2-integ'.",
      "Remove worktree wt/mp-m2-installer-integ."
    ],
    "worktree": "wt/mp-m2-installer-integ",
    "integration_task": "M2-integ",
    "kickoff_prompt": "docs/project_management/next/p0-platform-stability-macOS-parity/kickoff_prompts/M2-integ.md",
    "depends_on": [
      "M2-code",
      "M2-test"
    ],
    "concurrent_with": []
  },
  {
    "id": "M3-code",
    "name": "Backend & doctor parity \u2013 code",
    "type": "code",
    "phase": "M3",
    "status": "pending",
    "description": "Propagate policy fs_mode to mac backend, fix readiness/forwarding ordering, align socket/group expectations, and update doctor/doc/shim/health flows per M3-spec.",
    "references": [
      "docs/project_management/next/p0-platform-stability-macOS-parity/plan.md",
      "docs/project_management/next/p0-platform-stability-macOS-parity/M3-spec.md",
      "docs/project_management/next/p0-platform-stability/manual_testing_playbook.md"
    ],
    "acceptance_criteria": [
      "Mac backend honors WorldSpec.fs_mode across PTY/non-PTY and replay paths.",
      "Agent readiness establishes forwarding before probing; no spurious failures from missing pre-forward UDS.",
      "Socket/group expectations are aligned or documented, and doctor reflects fs_mode/socket activation status with mac guidance.",
      "Shim status (text/JSON) on mac reports socket activation and fs_mode in parity with Linux P0 outputs (document mac-only exceptions if any).",
      "Health CLI (text/JSON) mirrors Linux manager parity/socket signaling on mac or clearly documents deviations.",
      "Docs/manual flows updated where code changes alter behavior."
    ],
    "start_checklist": [
      "git checkout feat/p0-platform-stability-macOS-parity && git pull --ff-only",
      "Read plan, tasks.json, session_log.md, M3-spec.md, kickoff prompt",
      "Set task status to in_progress in tasks.json (orchestration branch)",
      "Add START entry to session_log.md; commit docs with message 'docs: start M3-code'",
      "Create branch mp-m3-backend-code from feat/p0-platform-stability-macOS-parity; run `git worktree add wt/mp-m3-backend-code mp-m3-backend-code`.",
      "Do not edit docs/tasks/session_log.md from the worktree."
    ],
    "end_checklist": [
      "Run required commands (capture outputs): cargo fmt; cargo clippy --workspace --all-targets -- -D warnings.",
      "Inside wt/mp-m3-backend-code, commit M3-code changes to branch mp-m3-backend-code (no docs/tasks/session_log edits).",
      "Outside the worktree, ensure branch mp-m3-backend-code contains the new commit (fast-forward if needed); do not merge into feat/p0-platform-stability-macOS-parity.",
      "Checkout feat/p0-platform-stability-macOS-parity; update tasks.json to completed; add an END entry to session_log.md with commands/results/blockers; create downstream prompts if missing; commit docs with 'docs: finish M3-code'.",
      "Remove worktree wt/mp-m3-backend-code."
    ],
    "worktree": "wt/mp-m3-backend-code",
    "integration_task": "M3-integ",
    "kickoff_prompt": "docs/project_management/next/p0-platform-stability-macOS-parity/kickoff_prompts/M3-code.md",
    "depends_on": [
      "M2-integ"
    ],
    "concurrent_with": [
      "M3-test"
    ]
  },
  {
    "id": "M3-test",
    "name": "Backend & doctor parity \u2013 test",
    "type": "test",
    "phase": "M3",
    "status": "pending",
    "description": "Add tests/fixtures for mac backend fs_mode propagation, doctor/shim-status/health outputs, and readiness/forwarding ordering per M3-spec.",
    "references": [
      "docs/project_management/next/p0-platform-stability-macOS-parity/plan.md",
      "docs/project_management/next/p0-platform-stability-macOS-parity/M3-spec.md"
    ],
    "acceptance_criteria": [
      "Tests validate fs_mode propagation and doctor JSON/text outputs (platform-agnostic portions).",
      "Readiness ordering and socket activation behaviors are covered by unit/integration fixtures where feasible.",
      "Shim-status and health outputs include mac parity checks for socket activation/fs_mode/manager states (platform-agnostic portions), with skips documented.",
      "Required commands executed (fmt + targeted tests) and recorded in session_log.md.",
      "No production code changes."
    ],
    "start_checklist": [
      "git checkout feat/p0-platform-stability-macOS-parity && git pull --ff-only",
      "Read plan, tasks.json, session_log.md, M3-spec.md, kickoff prompt",
      "Set task status to in_progress in tasks.json (orchestration branch)",
      "Add START entry to session_log.md; commit docs with message 'docs: start M3-test'",
      "Create branch mp-m3-backend-test from feat/p0-platform-stability-macOS-parity; run `git worktree add wt/mp-m3-backend-test mp-m3-backend-test`.",
      "Do not edit docs/tasks/session_log.md from the worktree."
    ],
    "end_checklist": [
      "Run required commands (capture outputs): cargo fmt; targeted cargo test commands for suites added/updated.",
      "Inside wt/mp-m3-backend-test, commit M3-test changes to branch mp-m3-backend-test (no docs/tasks/session_log edits).",
      "Outside the worktree, ensure branch mp-m3-backend-test contains the new commit (fast-forward if needed); do not merge into feat/p0-platform-stability-macOS-parity.",
      "Checkout feat/p0-platform-stability-macOS-parity; update tasks.json to completed; add an END entry to session_log.md with commands/results/blockers; create downstream prompts if missing; commit docs with 'docs: finish M3-test'.",
      "Remove worktree wt/mp-m3-backend-test."
    ],
    "worktree": "wt/mp-m3-backend-test",
    "integration_task": "M3-integ",
    "kickoff_prompt": "docs/project_management/next/p0-platform-stability-macOS-parity/kickoff_prompts/M3-test.md",
    "depends_on": [
      "M2-integ"
    ],
    "concurrent_with": [
      "M3-code"
    ]
  },
  {
    "id": "M3-integ",
    "name": "Backend & doctor parity \u2013 integration",
    "type": "integration",
    "phase": "M3",
    "status": "pending",
    "description": "Merge M3 code/test, reconcile mac backend/doctor parity with the spec, and gate with fmt/clippy/tests/make preflight.",
    "references": [
      "docs/project_management/next/p0-platform-stability-macOS-parity/plan.md",
      "docs/project_management/next/p0-platform-stability-macOS-parity/M3-spec.md"
    ],
    "acceptance_criteria": [
      "Backend/doctor parity changes merged and match M3-spec.",
      "cargo fmt + clippy + relevant tests (including shim-status/health parity coverage) + make preflight executed and logged.",
      "Integration merged fast-forward; tasks/logs updated."
    ],
    "start_checklist": [
      "git checkout feat/p0-platform-stability-macOS-parity && git pull --ff-only",
      "Read plan, tasks.json, session_log.md, M3-spec.md, kickoff prompt",
      "Set task status to in_progress in tasks.json (orchestration branch)",
      "Add START entry to session_log.md; commit docs with message 'docs: start M3-integ'",
      "Create branch mp-m3-backend-integ from feat/p0-platform-stability-macOS-parity; run `git worktree add wt/mp-m3-backend-integ mp-m3-backend-integ`.",
      "Do not edit docs/tasks/session_log.md from the worktree."
    ],
    "end_checklist": [
      "Merge upstream code/test branches for M3 into mp-m3-backend-integ inside wt/mp-m3-backend-integ and reconcile behavior to the spec.",
      "Run required commands (capture outputs): cargo fmt; cargo clippy --workspace --all-targets -- -D warnings; relevant tests; make preflight.",
      "Commit integration changes on branch mp-m3-backend-integ.",
      "Fast-forward merge mp-m3-backend-integ into feat/p0-platform-stability-macOS-parity; update tasks.json to completed; add an END entry to session_log.md with commands/results/blockers; commit docs with 'docs: finish M3-integ'.",
      "Remove worktree wt/mp-m3-backend-integ."
    ],
    "worktree": "wt/mp-m3-backend-integ",
    "integration_task": "M3-integ",
    "kickoff_prompt": "docs/project_management/next/p0-platform-stability-macOS-parity/kickoff_prompts/M3-integ.md",
    "depends_on": [
      "M3-code",
      "M3-test"
    ],
    "concurrent_with": []
  }
]
