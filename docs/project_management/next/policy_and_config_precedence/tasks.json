{
  "meta": {
    "schema_version": 3,
    "feature": "policy_and_config_precedence",
    "cross_platform": true,
    "execution_gates": true,
    "automation": {
      "enabled": true,
      "orchestration_branch": "feat/policy_and_config_precedence"
    },
    "platforms_required": ["linux", "macos", "windows"],
    "wsl_required": false
  },
  "tasks": [
    {
      "id": "F0-exec-preflight",
      "name": "Execution preflight gate (feature start)",
      "type": "ops",
      "phase": "Feature Gates",
      "status": "completed",
      "description": "Run the execution preflight gate and fill execution_preflight_report.md before starting PCP0 triads.",
      "references": [
        "docs/project_management/standards/EXECUTION_PREFLIGHT_GATE_STANDARD.md",
        "docs/project_management/next/policy_and_config_precedence/execution_preflight_report.md",
        "docs/project_management/next/ADR-0005-workspace-config-precedence-over-env.md",
        "docs/project_management/next/policy_and_config_precedence/plan.md",
        "docs/project_management/next/policy_and_config_precedence/tasks.json",
        "docs/project_management/next/policy_and_config_precedence/session_log.md",
        "docs/project_management/next/policy_and_config_precedence/PCP0-spec.md",
        "docs/project_management/next/policy_and_config_precedence/integration_map.md",
        "docs/project_management/next/policy_and_config_precedence/manual_testing_playbook.md",
        "docs/project_management/next/policy_and_config_precedence/smoke/linux-smoke.sh",
        "docs/project_management/next/policy_and_config_precedence/smoke/macos-smoke.sh",
        "docs/project_management/next/policy_and_config_precedence/smoke/windows-smoke.ps1"
      ],
      "acceptance_criteria": [
        "execution_preflight_report.md contains a concrete recommendation (ACCEPT or REVISE)",
        "If the recommendation is REVISE, PCP0 triads do not start until the listed issues are resolved and preflight is re-run"
      ],
      "start_checklist": [
        "Run: make triad-orch-ensure FEATURE_DIR=\"docs/project_management/next/policy_and_config_precedence\"",
        "Read ADR + plan/spec/playbook + this kickoff prompt",
        "Set F0-exec-preflight status to in_progress in tasks.json; add START entry to session_log.md; commit docs"
      ],
      "end_checklist": [
        "Fill execution_preflight_report.md with ACCEPT/REVISE and any required fixes",
        "Set F0-exec-preflight status to completed in tasks.json; add END entry to session_log.md; commit docs"
      ],
      "worktree": null,
      "integration_task": null,
      "kickoff_prompt": "docs/project_management/next/policy_and_config_precedence/kickoff_prompts/F0-exec-preflight.md",
      "depends_on": [],
      "concurrent_with": []
    },
    {
      "id": "PCP0-code",
      "name": "Workspace config precedence over env (code)",
      "type": "code",
      "phase": "Policy + Config Precedence",
      "status": "completed",
      "description": "Implement workspace-over-env precedence in the effective config resolver (production code only).",
      "references": [
        "docs/project_management/next/ADR-0005-workspace-config-precedence-over-env.md",
        "docs/project_management/next/policy_and_config_precedence/plan.md",
        "docs/project_management/next/policy_and_config_precedence/PCP0-spec.md",
        "docs/project_management/next/policy_and_config_precedence/decision_register.md (DR-0001)",
        "docs/project_management/next/policy_and_config_precedence/integration_map.md",
        "docs/project_management/standards/TASK_TRIADS_AND_FEATURE_SETUP.md",
        "docs/project_management/standards/PLATFORM_INTEGRATION_AND_CI.md",
        "docs/project_management/standards/EXIT_CODE_TAXONOMY.md"
      ],
      "acceptance_criteria": [
        "Effective config precedence matches ADR-0005: CLI flags > workspace config > env vars > global config > defaults (when a workspace exists)",
        "No-workspace behavior for workspace-scoped config commands is unchanged",
        "Config parsing remains strict and rejects unknown keys and type mismatches as hard errors"
      ],
      "start_checklist": [
        "git checkout feat/policy_and_config_precedence && git pull --ff-only",
        "Read plan/spec/decision_register/integration_map for PCP0 and this prompt",
        "Update tasks.json status to in_progress and add START entry to session_log.md; commit docs on orchestration branch",
        "Create branch pcp-pcp0-precedence-code and worktree wt/pcp0-precedence-code; do not edit planning docs inside the worktree"
      ],
      "end_checklist": [
        "Run cargo fmt",
        "Run cargo clippy --workspace --all-targets -- -D warnings",
        "Commit worktree changes to the task branch",
        "Merge/fast-forward into orchestration branch; update tasks.json + session_log.md END entry; commit docs"
      ],
      "git_branch": "pcp-pcp0-precedence-code",
      "required_make_targets": ["triad-code-checks"],
      "worktree": "wt/pcp0-precedence-code",
      "integration_task": "PCP0-integ-core",
      "kickoff_prompt": "docs/project_management/next/policy_and_config_precedence/kickoff_prompts/PCP0-code.md",
      "depends_on": ["F0-exec-preflight"],
      "concurrent_with": ["PCP0-test"]
    },
    {
      "id": "PCP0-test",
      "name": "Workspace config precedence over env (test)",
      "type": "test",
      "phase": "Policy + Config Precedence",
      "status": "completed",
      "description": "Update/add tests that lock the workspace-over-env precedence contract (tests only).",
      "references": [
        "docs/project_management/next/policy_and_config_precedence/PCP0-spec.md",
        "docs/project_management/next/policy_and_config_precedence/decision_register.md (DR-0001)",
        "docs/project_management/standards/EXIT_CODE_TAXONOMY.md",
        "docs/project_management/standards/TASK_TRIADS_AND_FEATURE_SETUP.md"
      ],
      "acceptance_criteria": [
        "Tests assert that env does not override workspace config for any config key when a workspace exists",
        "Tests assert that CLI flags override workspace config for the CLI-covered subset of keys",
        "Tests continue to assert that protected excludes are always present and cannot be removed"
      ],
      "start_checklist": [
        "git checkout feat/policy_and_config_precedence && git pull --ff-only",
        "Read plan/spec for PCP0 and this prompt",
        "Update tasks.json status to in_progress and add START entry to session_log.md; commit docs on orchestration branch",
        "Create branch pcp-pcp0-precedence-test and worktree wt/pcp0-precedence-test; do not edit planning docs inside the worktree"
      ],
      "end_checklist": [
        "Run cargo fmt",
        "Run targeted cargo test commands for the tests added/modified",
        "Commit worktree changes to the task branch",
        "Merge/fast-forward into orchestration branch; update tasks.json + session_log.md END entry; commit docs"
      ],
      "git_branch": "pcp-pcp0-precedence-test",
      "required_make_targets": ["triad-test-checks"],
      "worktree": "wt/pcp0-precedence-test",
      "integration_task": "PCP0-integ-core",
      "kickoff_prompt": "docs/project_management/next/policy_and_config_precedence/kickoff_prompts/PCP0-test.md",
      "depends_on": ["F0-exec-preflight"],
      "concurrent_with": ["PCP0-code"]
    },
    {
      "id": "PCP0-integ-core",
      "name": "Workspace config precedence over env (integration core)",
      "type": "integration",
      "phase": "Policy + Config Precedence",
      "status": "completed",
      "description": "Merge PCP0 code+tests and make the slice green on the primary dev platform.",
      "references": [
        "docs/project_management/next/policy_and_config_precedence/PCP0-spec.md",
        "docs/project_management/next/policy_and_config_precedence/smoke/linux-smoke.sh",
        "docs/project_management/next/policy_and_config_precedence/smoke/macos-smoke.sh",
        "docs/project_management/next/policy_and_config_precedence/smoke/windows-smoke.ps1",
        "docs/project_management/standards/PLATFORM_INTEGRATION_AND_CI.md",
        "docs/project_management/standards/SLICE_CLOSEOUT_GATE_STANDARD.md",
        "docs/project_management/standards/TASK_TRIADS_AND_FEATURE_SETUP.md"
      ],
      "acceptance_criteria": [
        "Core slice is green under make integ-checks and matches PCP0-spec.md"
      ],
      "start_checklist": [
        "make triad-orch-ensure FEATURE_DIR=\"docs/project_management/next/policy_and_config_precedence\"",
        "Read PCP0-spec.md and confirm PCP0-code and PCP0-test branches are ready to merge",
        "Update tasks.json status to in_progress and add START entry to session_log.md; commit docs on orchestration branch",
        "Run: make triad-task-start FEATURE_DIR=\"docs/project_management/next/policy_and_config_precedence\" TASK_ID=\"PCP0-integ-core\""
      ],
      "end_checklist": [
        "cargo fmt",
        "cargo clippy --workspace --all-targets -- -D warnings",
        "Run relevant tests",
        "make integ-checks",
        "Dispatch cross-platform smoke via CI (record run ids/URLs): make feature-smoke FEATURE_DIR=\"docs/project_management/next/policy_and_config_precedence\" PLATFORM=all RUNNER_KIND=self-hosted WORKFLOW_REF=\"feat/policy_and_config_precedence\"",
        "If any platform fails, start only the failing platform-fix tasks from the emitted RUN_ID: make triad-task-start-platform-fixes-from-smoke FEATURE_DIR=\"docs/project_management/next/policy_and_config_precedence\" SLICE_ID=\"PCP0\" SMOKE_RUN_ID=\"<run-id>\"",
        "After failing platforms are green, start the final aggregator: make triad-task-start-integ-final FEATURE_DIR=\"docs/project_management/next/policy_and_config_precedence\" SLICE_ID=\"PCP0\"",
        "From inside the worktree: make triad-task-finish TASK_ID=\"PCP0-integ-core\"",
        "On the orchestration branch: update tasks.json + session_log.md END entry; commit docs"
      ],
      "git_branch": "pcp-pcp0-precedence-integ-core",
      "required_make_targets": ["integ-checks"],
      "merge_to_orchestration": false,
      "worktree": "wt/pcp0-precedence-integ-core",
      "integration_task": "PCP0-integ-core",
      "kickoff_prompt": "docs/project_management/next/policy_and_config_precedence/kickoff_prompts/PCP0-integ-core.md",
      "depends_on": ["PCP0-code", "PCP0-test"],
      "concurrent_with": []
    },
    {
      "id": "PCP0-integ-linux",
      "name": "Workspace config precedence over env (integration Linux)",
      "type": "integration",
      "phase": "Policy + Config Precedence",
      "status": "completed",
      "description": "Linux platform-fix integration task (may be a no-op if already green).",
      "references": [
        "docs/project_management/next/policy_and_config_precedence/PCP0-spec.md",
        "docs/project_management/next/policy_and_config_precedence/smoke/linux-smoke.sh",
        "docs/project_management/standards/PLATFORM_INTEGRATION_AND_CI.md",
        "docs/project_management/standards/TASK_TRIADS_AND_FEATURE_SETUP.md"
      ],
      "acceptance_criteria": [
        "linux smoke is green for this slice"
      ],
      "start_checklist": [
        "Run on linux host if possible",
        "make triad-orch-ensure FEATURE_DIR=\"docs/project_management/next/policy_and_config_precedence\"",
        "Read PCP0-spec.md and kickoff prompt",
        "Set status to in_progress; add START entry; commit docs",
        "Run: make triad-task-start FEATURE_DIR=\"docs/project_management/next/policy_and_config_precedence\" TASK_ID=\"PCP0-integ-linux\""
      ],
      "end_checklist": [
        "Dispatch platform smoke via CI: make feature-smoke FEATURE_DIR=\"docs/project_management/next/policy_and_config_precedence\" PLATFORM=linux RUNNER_KIND=self-hosted WORKFLOW_REF=\"feat/policy_and_config_precedence\"",
        "If needed: fix + fmt/clippy + targeted tests",
        "Ensure smoke is green; record run id/URL",
        "From inside the worktree: make triad-task-finish TASK_ID=\"PCP0-integ-linux\"",
        "On the orchestration branch: update tasks.json + session_log.md END entry; commit docs"
      ],
      "git_branch": "pcp-pcp0-precedence-integ-linux",
      "required_make_targets": ["triad-code-checks"],
      "merge_to_orchestration": false,
      "worktree": "wt/pcp0-precedence-integ-linux",
      "integration_task": "PCP0-integ-linux",
      "kickoff_prompt": "docs/project_management/next/policy_and_config_precedence/kickoff_prompts/PCP0-integ-linux.md",
      "depends_on": ["PCP0-integ-core"],
      "concurrent_with": [],
      "platform": "linux",
      "runner": "github-actions",
      "workflow": ".github/workflows/feature-smoke.yml"
    },
    {
      "id": "PCP0-integ-macos",
      "name": "Workspace config precedence over env (integration macOS)",
      "type": "integration",
      "phase": "Policy + Config Precedence",
      "status": "completed",
      "description": "macOS platform-fix integration task (may be a no-op if already green).",
      "references": [
        "docs/project_management/next/policy_and_config_precedence/PCP0-spec.md",
        "docs/project_management/next/policy_and_config_precedence/smoke/macos-smoke.sh",
        "docs/project_management/standards/PLATFORM_INTEGRATION_AND_CI.md",
        "docs/project_management/standards/TASK_TRIADS_AND_FEATURE_SETUP.md"
      ],
      "acceptance_criteria": [
        "macos smoke is green for this slice"
      ],
      "start_checklist": [
        "Run on macos host if possible",
        "make triad-orch-ensure FEATURE_DIR=\"docs/project_management/next/policy_and_config_precedence\"",
        "Read PCP0-spec.md and kickoff prompt",
        "Set status to in_progress; add START entry; commit docs",
        "Run: make triad-task-start FEATURE_DIR=\"docs/project_management/next/policy_and_config_precedence\" TASK_ID=\"PCP0-integ-macos\""
      ],
      "end_checklist": [
        "Dispatch platform smoke via CI: make feature-smoke FEATURE_DIR=\"docs/project_management/next/policy_and_config_precedence\" PLATFORM=macos RUNNER_KIND=self-hosted WORKFLOW_REF=\"feat/policy_and_config_precedence\"",
        "If needed: fix + fmt/clippy + targeted tests",
        "Ensure smoke is green; record run id/URL",
        "From inside the worktree: make triad-task-finish TASK_ID=\"PCP0-integ-macos\"",
        "On the orchestration branch: update tasks.json + session_log.md END entry; commit docs"
      ],
      "git_branch": "pcp-pcp0-precedence-integ-macos",
      "required_make_targets": ["triad-code-checks"],
      "merge_to_orchestration": false,
      "worktree": "wt/pcp0-precedence-integ-macos",
      "integration_task": "PCP0-integ-macos",
      "kickoff_prompt": "docs/project_management/next/policy_and_config_precedence/kickoff_prompts/PCP0-integ-macos.md",
      "depends_on": ["PCP0-integ-core"],
      "concurrent_with": [],
      "platform": "macos",
      "runner": "github-actions",
      "workflow": ".github/workflows/feature-smoke.yml"
    },
    {
      "id": "PCP0-integ-windows",
      "name": "Workspace config precedence over env (integration Windows)",
      "type": "integration",
      "phase": "Policy + Config Precedence",
      "status": "completed",
      "description": "Windows platform-fix integration task (may be a no-op if already green).",
      "references": [
        "docs/project_management/next/policy_and_config_precedence/PCP0-spec.md",
        "docs/project_management/next/policy_and_config_precedence/smoke/windows-smoke.ps1",
        "docs/project_management/standards/PLATFORM_INTEGRATION_AND_CI.md",
        "docs/project_management/standards/TASK_TRIADS_AND_FEATURE_SETUP.md"
      ],
      "acceptance_criteria": [
        "windows smoke is green for this slice"
      ],
      "start_checklist": [
        "Run on windows host if possible",
        "make triad-orch-ensure FEATURE_DIR=\"docs/project_management/next/policy_and_config_precedence\"",
        "Read PCP0-spec.md and kickoff prompt",
        "Set status to in_progress; add START entry; commit docs",
        "Run: make triad-task-start FEATURE_DIR=\"docs/project_management/next/policy_and_config_precedence\" TASK_ID=\"PCP0-integ-windows\""
      ],
      "end_checklist": [
        "Dispatch platform smoke via CI: make feature-smoke FEATURE_DIR=\"docs/project_management/next/policy_and_config_precedence\" PLATFORM=windows RUNNER_KIND=self-hosted WORKFLOW_REF=\"feat/policy_and_config_precedence\"",
        "If needed: fix + fmt/clippy + targeted tests",
        "Ensure smoke is green; record run id/URL",
        "From inside the worktree: make triad-task-finish TASK_ID=\"PCP0-integ-windows\"",
        "On the orchestration branch: update tasks.json + session_log.md END entry; commit docs"
      ],
      "git_branch": "pcp-pcp0-precedence-integ-windows",
      "required_make_targets": ["triad-code-checks"],
      "merge_to_orchestration": false,
      "worktree": "wt/pcp0-precedence-integ-windows",
      "integration_task": "PCP0-integ-windows",
      "kickoff_prompt": "docs/project_management/next/policy_and_config_precedence/kickoff_prompts/PCP0-integ-windows.md",
      "depends_on": ["PCP0-integ-core"],
      "concurrent_with": [],
      "platform": "windows",
      "runner": "github-actions",
      "workflow": ".github/workflows/feature-smoke.yml"
    },
    {
      "id": "PCP0-integ",
      "name": "Workspace config precedence over env (integration final)",
      "type": "integration",
      "phase": "Policy + Config Precedence",
      "status": "completed",
      "description": "Final cross-platform integration: merge any platform fixes and confirm all required platforms are green.",
      "references": [
        "docs/project_management/next/policy_and_config_precedence/PCP0-spec.md",
        "docs/project_management/next/policy_and_config_precedence/PCP0-closeout_report.md",
        "docs/project_management/next/policy_and_config_precedence/manual_testing_playbook.md",
        "docs/project_management/next/policy_and_config_precedence/smoke/linux-smoke.sh",
        "docs/project_management/next/policy_and_config_precedence/smoke/macos-smoke.sh",
        "docs/project_management/next/policy_and_config_precedence/smoke/windows-smoke.ps1",
        "docs/project_management/standards/PLATFORM_INTEGRATION_AND_CI.md",
        "docs/project_management/standards/SLICE_CLOSEOUT_GATE_STANDARD.md",
        "docs/project_management/standards/TASK_TRIADS_AND_FEATURE_SETUP.md"
      ],
      "acceptance_criteria": [
        "PCP0 code and tests are merged and match PCP0-spec.md exactly",
        "cargo fmt, cargo clippy (-D warnings), relevant cargo test, and make integ-checks succeed",
        "Feature-local smoke scripts validate workspace-over-env precedence and results are recorded in session_log.md",
        "PCP0-closeout_report.md is completed with command evidence and cross-platform smoke results/URLs"
      ],
      "start_checklist": [
        "make triad-orch-ensure FEATURE_DIR=\"docs/project_management/next/policy_and_config_precedence\"",
        "Confirm PCP0-integ-core and all required platform integration tasks are completed",
        "Update tasks.json status to in_progress and add START entry to session_log.md; commit docs on orchestration branch",
        "Run: make triad-task-start FEATURE_DIR=\"docs/project_management/next/policy_and_config_precedence\" TASK_ID=\"PCP0-integ\""
      ],
      "end_checklist": [
        "Merge platform-fix branches (if any) + resolve conflicts",
        "Run cargo fmt, cargo clippy, relevant cargo test, and make integ-checks",
        "Re-run cross-platform smoke via CI: make feature-smoke FEATURE_DIR=\"docs/project_management/next/policy_and_config_precedence\" PLATFORM=all RUNNER_KIND=self-hosted WORKFLOW_REF=\"feat/policy_and_config_precedence\"",
        "Fill PCP0-closeout_report.md (required end gate for PCP0) and reference it in the END entry",
        "From inside the worktree: make triad-task-finish TASK_ID=\"PCP0-integ\"",
        "On the orchestration branch: update tasks.json + session_log.md END entry; commit docs"
      ],
      "git_branch": "pcp-pcp0-precedence-integ",
      "required_make_targets": ["integ-checks"],
      "merge_to_orchestration": true,
      "worktree": "wt/pcp0-precedence-integ",
      "integration_task": "PCP0-integ",
      "kickoff_prompt": "docs/project_management/next/policy_and_config_precedence/kickoff_prompts/PCP0-integ.md",
      "depends_on": ["PCP0-integ-core", "PCP0-integ-linux", "PCP0-integ-macos", "PCP0-integ-windows"],
      "concurrent_with": []
    },
    {
      "id": "FZ-feature-cleanup",
      "name": "Feature cleanup (worktree retention)",
      "type": "ops",
      "phase": "Feature Cleanup",
      "status": "pending",
      "description": "Feature-level cleanup: remove retained task worktrees and optionally prune task branches.",
      "references": [
        "docs/project_management/standards/TASK_TRIADS_AND_FEATURE_SETUP.md",
        "scripts/triad/feature_cleanup.sh"
      ],
      "acceptance_criteria": [
        "Cleanup completed and summary recorded in session_log.md"
      ],
      "start_checklist": [
        "make triad-orch-ensure FEATURE_DIR=\"docs/project_management/next/policy_and_config_precedence\"",
        "Confirm all tasks are completed and merged as intended",
        "Set status to in_progress; add START entry; commit docs"
      ],
      "end_checklist": [
        "Run: make triad-feature-cleanup FEATURE_DIR=\"docs/project_management/next/policy_and_config_precedence\" DRY_RUN=1 REMOVE_WORKTREES=1 PRUNE_LOCAL=1",
        "Then run: make triad-feature-cleanup FEATURE_DIR=\"docs/project_management/next/policy_and_config_precedence\" REMOVE_WORKTREES=1 PRUNE_LOCAL=1",
        "Set status to completed; add END entry with script summary; commit docs"
      ],
      "worktree": null,
      "integration_task": null,
      "kickoff_prompt": "docs/project_management/next/policy_and_config_precedence/kickoff_prompts/FZ-feature-cleanup.md",
      "depends_on": ["PCP0-integ"],
      "concurrent_with": []
    }
  ]
}
