{
  "tasks": [
    {
      "id": "S0-code",
      "name": "Bundle manager manifest in releases",
      "type": "code",
      "phase": "Settings Stack",
      "status": "completed",
      "description": "Ensure release bundles + installers carry config/manager_hooks.yaml (and related manifests) so health/doctor work out of the box.",
      "references": [
        "docs/project_management/next/settings-stack/settings_stack_plan.md",
        "dist/scripts/collect-supporting-artifacts.sh",
        "dist/scripts/assemble-release-bundles.sh",
        "scripts/substrate/install-substrate.sh",
        "scripts/substrate/install.sh",
        "docs/INSTALLATION.md"
      ],
      "acceptance_criteria": [
        "Support bundle includes config/ directory (manager manifest, world deps manifest).",
        "Platform bundles copy config/ into versions/<ver>/config during install.",
        "Installer/uninstaller handle the new config directory without leaving stale files.",
        "Docs mention the manifest location under ~/.substrate/versions/<ver>/config."
      ],
      "start_checklist": [
        "Checkout feat/settings-stack, pull latest",
        "Set S0-code to in_progress, log START entry, commit docs update",
        "Create task branch ss-s0-manifest-code",
        "Create worktree wt/ss-s0-manifest-code from that branch"
      ],
      "end_checklist": [
        "Ensure required fmt/lint/tests per prompt are green",
        "Commit worktree changes",
        "Merge task branch back to feat/settings-stack",
        "Update tasks.json + session_log.md with END entry",
        "Create/confirm next kickoff prompts as required",
        "Commit docs update on feat/settings-stack"
      ],
      "depends_on": [],
      "concurrent_with": [
        "S0-test"
      ],
      "worktree": "wt/ss-s0-manifest-code",
      "integration_task": "S0-integ",
      "kickoff_prompt": "docs/project_management/next/settings-stack/kickoff_prompts/S0-code.md"
    },
    {
      "id": "S0-test",
      "name": "Test bundled manager manifest",
      "type": "test",
      "phase": "Settings Stack",
      "status": "completed",
      "description": "Add/extend tests to confirm installers emit config/manager_hooks.yaml and that substrate health works after install.",
      "references": [
        "docs/project_management/next/settings-stack/settings_stack_plan.md",
        "tests/installers/install_smoke.sh",
        "scripts/substrate/install-substrate.sh",
        "docs/USAGE.md"
      ],
      "acceptance_criteria": [
        "Installer harness checks that config/manager_hooks.yaml exists under the temp prefix after default and --no-world runs.",
        "Add a smoke test to run 'substrate health --json' (or equivalent) against the installed prefix, confirming it no longer errors.",
        "No production code modifications beyond minor test helpers."
      ],
      "start_checklist": [
        "Checkout feat/settings-stack, pull latest",
        "Set S0-test to in_progress, log START entry, commit docs update",
        "Create task branch ss-s0-manifest-test",
        "Create worktree wt/ss-s0-manifest-test from that branch"
      ],
      "end_checklist": [
        "Ensure required fmt/lint/tests per prompt are green",
        "Commit worktree changes",
        "Merge task branch back to feat/settings-stack",
        "Update tasks.json + session_log.md with END entry",
        "Create/confirm next kickoff prompts as required",
        "Commit docs update on feat/settings-stack"
      ],
      "depends_on": [],
      "concurrent_with": [
        "S0-code"
      ],
      "worktree": "wt/ss-s0-manifest-test",
      "integration_task": "S0-integ",
      "kickoff_prompt": "docs/project_management/next/settings-stack/kickoff_prompts/S0-test.md"
    },
    {
      "id": "S0-integ",
      "name": "Integrate manifest bundling",
      "type": "integration",
      "phase": "Settings Stack",
      "status": "completed",
      "description": "Merge the manifest-packaging code + tests, run required scripts, and ensure feat/settings-stack reflects the fix before later stages begin.",
      "references": [
        "docs/project_management/next/settings-stack/settings_stack_plan.md",
        "dist/scripts",
        "scripts/substrate",
        "tests/installers"
      ],
      "acceptance_criteria": [
        "wt/ss-s0-manifest-integ merges code/test branches with clean fmt/lint/test results.",
        "feat/settings-stack contains the final manifest-packaging changes plus doc/task/log updates.",
        "S1 kickoff prompts verified/updated based on the new baseline."
      ],
      "start_checklist": [
        "Checkout feat/settings-stack, pull latest",
        "Confirm S0-code/S0-test completed",
        "Set S0-integ to in_progress, log START entry, commit docs update",
        "Create task branch ss-s0-manifest-integ",
        "Create worktree wt/ss-s0-manifest-integ from that branch"
      ],
      "end_checklist": [
        "Merge code/test branches into integration branch/worktree and resolve conflicts",
        "Run required fmt/clippy/tests",
        "Merge integration branch back to feat/settings-stack",
        "Update tasks.json + session_log.md with END entry",
        "Push or hand off"
      ],
      "depends_on": [
        "S0-code",
        "S0-test"
      ],
      "concurrent_with": [],
      "worktree": "wt/ss-s0-manifest-integ",
      "integration_task": null,
      "kickoff_prompt": "docs/project_management/next/settings-stack/kickoff_prompts/S0-integ.md"
    },
    {
      "id": "S1-code",
      "name": "Migrate install config to TOML",
      "type": "code",
      "phase": "Settings Stack",
      "status": "completed",
      "description": "Replace ~/.substrate/config.json with config.toml, update installers/CLI to read & write TOML, and refresh docs without touching tests.",
      "references": [
        "docs/project_management/next/settings-stack/settings_stack_plan.md",
        "docs/INSTALLATION.md",
        "docs/CONFIGURATION.md",
        "crates/shell/src/commands/world_enable.rs",
        "scripts/substrate/install-substrate.sh",
        "scripts/substrate/uninstall.sh"
      ],
      "acceptance_criteria": [
        "Install metadata persists to config.toml with [install] section.",
        "Shell reads TOML and exports SUBSTRATE_WORLD* envs correctly.",
        "Installer/uninstaller scripts write/read the TOML file and keep manager_env exports intact.",
        "Docs updated to mention TOML format."
      ],
      "start_checklist": [
        "Checkout feat/settings-stack, pull latest",
        "Set S1-code to in_progress in tasks.json",
        "Add START entry to session_log.md and commit docs update",
        "Create task branch ss-s1-config-code",
        "Create worktree wt/ss-s1-config-code from that branch"
      ],
      "end_checklist": [
        "Ensure required fmt/lint/tests per prompt are green",
        "Commit worktree changes",
        "Merge task branch back to feat/settings-stack",
        "Update tasks.json + session_log.md with END entry",
        "Create/confirm next kickoff prompts as required",
        "Commit docs update on feat/settings-stack"
      ],
      "depends_on": [
        "S0-integ"
      ],
      "concurrent_with": [
        "S1-test"
      ],
      "worktree": "wt/ss-s1-config-code",
      "integration_task": "S1-integ",
      "kickoff_prompt": "docs/project_management/next/settings-stack/kickoff_prompts/S1-code.md"
    },
    {
      "id": "S1-test",
      "name": "Test TOML install config",
      "type": "test",
      "phase": "Settings Stack",
      "status": "completed",
      "description": "Add/refresh tests that cover loading/saving config.toml and guard against regressions.",
      "references": [
        "docs/project_management/next/settings-stack/settings_stack_plan.md",
        "crates/shell/src/commands/world_enable.rs",
        "tests/installers/install_smoke.sh"
      ],
      "acceptance_criteria": [
        "Unit tests cover load/save of config.toml (missing keys, extras).",
        "Installer harness validates TOML output for default and --no-world paths.",
        "No production code changes beyond test scaffolding."
      ],
      "start_checklist": [
        "Checkout feat/settings-stack, pull latest",
        "Set S1-test to in_progress in tasks.json",
        "Add START entry to session_log.md and commit docs update",
        "Create task branch ss-s1-config-test",
        "Create worktree wt/ss-s1-config-test from that branch"
      ],
      "end_checklist": [
        "Ensure required fmt/lint/tests per prompt are green",
        "Commit worktree changes",
        "Merge task branch back to feat/settings-stack",
        "Update tasks.json + session_log.md with END entry",
        "Create/confirm next kickoff prompts as required",
        "Commit docs update on feat/settings-stack"
      ],
      "depends_on": [
        "S0-integ"
      ],
      "concurrent_with": [
        "S1-code"
      ],
      "worktree": "wt/ss-s1-config-test",
      "integration_task": "S1-integ",
      "kickoff_prompt": "docs/project_management/next/settings-stack/kickoff_prompts/S1-test.md"
    },
    {
      "id": "S1-integ",
      "name": "Integrate TOML install config",
      "type": "integration",
      "phase": "Settings Stack",
      "status": "completed",
      "description": "Merge the TOML code + tests into feat/settings-stack, resolve conflicts, and ensure fmt/clippy/tests pass.",
      "references": [
        "docs/project_management/next/settings-stack/settings_stack_plan.md",
        "crates/shell",
        "scripts/substrate",
        "tests/installers"
      ],
      "acceptance_criteria": [
        "wt/ss-s1-config-integ contains merged code+tests with fmt/clippy/tests passing.",
        "feat/settings-stack updated with integration results and doc/task/log entries committed.",
        "Next task kickoff prompts (S2 code/test) recorded by the test agent prior to this session."
      ],
      "start_checklist": [
        "Checkout feat/settings-stack, pull latest",
        "Confirm S1-code and S1-test are completed",
        "Set S1-integ to in_progress in tasks.json",
        "Add START entry to session_log.md and commit docs update",
        "Create task branch ss-s1-config-integ",
        "Create worktree wt/ss-s1-config-integ from that branch"
      ],
      "end_checklist": [
        "Merge code/test branches into integration branch/worktree and resolve conflicts",
        "Run required fmt/clippy/tests",
        "Merge integration branch back to feat/settings-stack",
        "Update tasks.json + session_log.md with END entry",
        "Push or hand off"
      ],
      "depends_on": [
        "S1-code",
        "S1-test"
      ],
      "concurrent_with": [],
      "worktree": "wt/ss-s1-config-integ",
      "integration_task": null,
      "kickoff_prompt": "To be created by S1-test"
    },
    {
      "id": "S2-code",
      "name": "Implement settings stack & world root flag",
      "type": "code",
      "phase": "Settings Stack",
      "status": "completed",
      "description": "Add CLI flag/env parsing, directory/local config readers, and shell plumbing for world root precedence.",
      "references": [
        "docs/project_management/next/settings-stack/settings_stack_plan.md",
        "docs/CONFIGURATION.md",
        "crates/shell/src/lib.rs",
        "crates/shell/src/platform_world",
        "crates/world"
      ],
      "acceptance_criteria": [
        "Shell honors --world-root-mode/--world-root-path with project/follow-cwd/custom modes.",
        "Directory config (.substrate/settings.toml) and global config (config.toml) parsed and merged respecting precedence.",
        "Env vars SUBSTRATE_WORLD_ROOT_MODE/PATH serve as fallback before default.",
        "Docs updated (USAGE/CONFIGURATION) to describe the stack.",
        "No test files touched."
      ],
      "start_checklist": [
        "Checkout feat/settings-stack, pull latest",
        "Set S2-code to in_progress, update session_log.md, commit docs update",
        "Create task branch ss-s2-settings-code",
        "Create worktree wt/ss-s2-settings-code from that branch"
      ],
      "end_checklist": [
        "Ensure required fmt/lint/tests per prompt are green",
        "Commit worktree changes",
        "Merge task branch back to feat/settings-stack",
        "Update tasks.json + session_log.md with END entry",
        "Create/confirm next kickoff prompts as required",
        "Commit docs update on feat/settings-stack"
      ],
      "depends_on": [
        "S1-integ"
      ],
      "concurrent_with": [
        "S2-test"
      ],
      "worktree": "wt/ss-s2-settings-code",
      "integration_task": "S2-integ",
      "kickoff_prompt": "docs/project_management/next/settings-stack/kickoff_prompts/S2-code.md"
    },
    {
      "id": "S2-test",
      "name": "Test settings stack",
      "type": "test",
      "phase": "Settings Stack",
      "status": "completed",
      "description": "Add targeted tests that verify precedence (flag > dir config > global config > env > default) and world root behavior.",
      "references": [
        "docs/project_management/next/settings-stack/settings_stack_plan.md",
        "crates/shell/src/lib.rs",
        "crates/world",
        "tests/installers/install_smoke.sh"
      ],
      "acceptance_criteria": [
        "Unit/integration tests cover layering (mock configs/env) and world root modes.",
        "Installer/tests updated to assert config.toml stores the new keys where appropriate.",
        "No production code modifications beyond test helpers."
      ],
      "start_checklist": [
        "Checkout feat/settings-stack, pull latest",
        "Set S2-test to in_progress, update session_log.md, commit docs update",
        "Create task branch ss-s2-settings-test",
        "Create worktree wt/ss-s2-settings-test from that branch"
      ],
      "end_checklist": [
        "Ensure required fmt/lint/tests per prompt are green",
        "Commit worktree changes",
        "Merge task branch back to feat/settings-stack",
        "Update tasks.json + session_log.md with END entry",
        "Create/confirm next kickoff prompts as required",
        "Commit docs update on feat/settings-stack"
      ],
      "depends_on": [
        "S1-integ"
      ],
      "concurrent_with": [
        "S2-code"
      ],
      "worktree": "wt/ss-s2-settings-test",
      "integration_task": "S2-integ",
      "kickoff_prompt": "docs/project_management/next/settings-stack/kickoff_prompts/S2-test.md"
    },
    {
      "id": "S2-integ",
      "name": "Integrate settings stack",
      "type": "integration",
      "phase": "Settings Stack",
      "status": "completed",
      "description": "Merge settings stack code/test worktrees, resolve conflicts, and ensure full fmt/clippy/test suite passes before updating feat/settings-stack.",
      "references": [
        "docs/project_management/next/settings-stack/settings_stack_plan.md",
        "crates/shell",
        "crates/world",
        "scripts/dev",
        "docs/CONFIGURATION.md"
      ],
      "acceptance_criteria": [
        "wt/ss-s2-settings-integ merges code+tests with clean fmt/clippy/tests.",
        "feat/settings-stack contains final changes plus session log/task updates.",
        "Kickoff prompts for any follow-up work recorded before ending session."
      ],
      "start_checklist": [
        "Checkout feat/settings-stack, pull latest",
        "Confirm S2-code/test completed",
        "Set S2-integ to in_progress, update session_log.md, commit docs update",
        "Create task branch ss-s2-settings-integ",
        "Create worktree wt/ss-s2-settings-integ from that branch"
      ],
      "end_checklist": [
        "Merge code/test branches into integration branch/worktree and resolve conflicts",
        "Run required fmt/clippy/tests",
        "Merge integration branch back to feat/settings-stack",
        "Update tasks.json + session_log.md with END entry",
        "Push or hand off"
      ],
      "depends_on": [
        "S2-code",
        "S2-test"
      ],
      "concurrent_with": [],
      "worktree": "wt/ss-s2-settings-integ",
      "integration_task": null,
      "kickoff_prompt": "docs/project_management/next/settings-stack/kickoff_prompts/S2-integ.md"
    },
    {
      "id": "S3-code",
      "name": "Implement caged root guard",
      "type": "code",
      "phase": "Settings Stack",
      "status": "completed",
      "description": "Replace the world-root flags with a standalone caged mode (boolean) that anchors the shell to a chosen root even when the world backend is disabled.",
      "references": [
        "docs/project_management/next/settings-stack/settings_stack_plan.md",
        "docs/CONFIGURATION.md",
        "crates/shell/src/lib.rs",
        "scripts/substrate/dev-install-substrate.sh",
        "tests/installers/install_smoke.sh"
      ],
      "acceptance_criteria": [
        "CLI exposes --caged/--uncaged (boolean) and persists the setting in config/settings files independent of world enablement.",
        "Anchor/root resolution still honors the existing precedence stack (flag > dir config > global config > env > default).",
        "Shell enforces the anchor locally: attempts to leave the root trigger an informational warning and return to the anchor, even when world isolation is disabled.",
        "Docs mention the renamed setting and how to configure it."
      ],
      "start_checklist": [
        "Checkout feat/settings-stack, pull latest",
        "Set S3-code to in_progress, update session_log.md, commit docs update",
        "Create task branch ss-s3-caged-code",
        "Create worktree wt/ss-s3-caged-code from that branch",
        "Ensure git status is clean before coding"
      ],
      "end_checklist": [
        "Ensure fmt/clippy/targeted tests pass; capture outputs in the log",
        "Commit worktree changes and merge back to feat/settings-stack",
        "Update tasks.json + session_log.md with END entry",
        "Confirm S3-test kickoff prompt path is recorded"
      ],
      "depends_on": [
        "S2-integ"
      ],
      "concurrent_with": [
        "S3-test"
      ],
      "worktree": "wt/ss-s3-caged-code",
      "integration_task": "S3-integ",
      "kickoff_prompt": "docs/project_management/next/settings-stack/kickoff_prompts/S3-code.md"
    },
    {
      "id": "S3-test",
      "name": "Test caged root guard",
      "type": "test",
      "phase": "Settings Stack",
      "status": "completed",
      "description": "Add tests that cover the caged boolean, anchor enforcement while world is disabled, and precedence across flags/config/env.",
      "references": [
        "docs/project_management/next/settings-stack/settings_stack_plan.md",
        "crates/shell/src/lib.rs",
        "tests/installers/install_smoke.sh",
        "scripts/substrate/dev-install-substrate.sh"
      ],
      "acceptance_criteria": [
        "Unit/integration tests verify caged enforcement when isolation is disabled and enabled (bounce back with warning).",
        "Tests assert config/dir settings/env/flag precedence for the caged setting (boolean) and that installer metadata carries it.",
        "No production code changes beyond minimal test scaffolding in this task."
      ],
      "start_checklist": [
        "Checkout feat/settings-stack, pull latest",
        "Set S3-test to in_progress, update session_log.md, commit docs update",
        "Create task branch ss-s3-caged-test",
        "Create worktree wt/ss-s3-caged-test from that branch",
        "Ensure git status is clean before editing tests"
      ],
      "end_checklist": [
        "Run fmt and targeted tests/scripts; capture outputs in the session log",
        "Commit worktree changes, merge back to feat/settings-stack, remove worktree",
        "Update tasks.json + session_log.md with END entry (commands/results/blockers)",
        "Create/confirm S3-integ kickoff prompt and reference prompts in the log"
      ],
      "depends_on": [
        "S2-integ"
      ],
      "concurrent_with": [
        "S3-code"
      ],
      "worktree": "wt/ss-s3-caged-test",
      "integration_task": "S3-integ",
      "kickoff_prompt": "docs/project_management/next/settings-stack/kickoff_prompts/S3-test.md"
    },
    {
      "id": "S3-integ",
      "name": "Integrate caged root guard",
      "type": "integration",
      "phase": "Settings Stack",
      "status": "completed",
      "description": "Merge the caged guard code + tests, resolve conflicts, and ensure fmt/clippy/tests and installer scenarios pass.",
      "references": [
        "docs/project_management/next/settings-stack/settings_stack_plan.md",
        "crates/shell",
        "scripts/substrate",
        "tests/installers"
      ],
      "acceptance_criteria": [
        "wt/ss-s3-caged-integ merges code+tests with clean fmt/clippy/tests/installer smoke.",
        "feat/settings-stack updated with integration results and doc/task/log entries committed.",
        "Any follow-up kickoff prompts are recorded before ending the session."
      ],
      "start_checklist": [
        "Checkout feat/settings-stack, pull latest",
        "Confirm S3-code/test completed",
        "Set S3-integ to in_progress, update session_log.md, commit docs update",
        "Create task branch ss-s3-caged-integ",
        "Create worktree wt/ss-s3-caged-integ from that branch"
      ],
      "end_checklist": [
        "Merge code/test branches into integration branch/worktree and resolve conflicts",
        "Run required fmt/clippy/tests and installer smoke scenarios",
        "Merge integration branch back to feat/settings-stack and remove the worktree",
        "Update tasks.json + session_log.md with END entry; push or hand off"
      ],
      "depends_on": [
        "S3-code",
        "S3-test"
      ],
      "concurrent_with": [],
      "worktree": "wt/ss-s3-caged-integ",
      "integration_task": null,
      "kickoff_prompt": "docs/project_management/next/settings-stack/kickoff_prompts/S3-integ.md"
    },
    {
      "id": "S4-code",
      "name": "Force world override flag",
      "type": "code",
      "phase": "Settings Stack",
      "status": "completed",
      "description": "Add a one-shot --world flag that overrides disabled installs/config to run in the world for a single invocation, keeping --no-world as the opt-out.",
      "references": [
        "docs/project_management/next/settings-stack/settings_stack_plan.md",
        "docs/CONFIGURATION.md",
        "crates/shell/src/lib.rs",
        "scripts/substrate/install-substrate.sh"
      ],
      "acceptance_criteria": [
        "CLI exposes --world alongside --no-world; --world forces world isolation even when install metadata/env config is disabled.",
        "Precedence documented: flag wins over config/env; --no-world still disables isolation explicitly.",
        "Docs mention the override flag, with examples for toggling per-invocation without changing install metadata.",
        "No regressions to caged/world-root precedence or installer metadata."
      ],
      "start_checklist": [
        "Checkout feat/settings-stack, pull latest",
        "Set S4-code to in_progress, update session_log.md, commit docs update",
        "Create task branch ss-s4-world-override-code",
        "Create worktree wt/ss-s4-world-override-code from that branch",
        "Ensure git status is clean before coding"
      ],
      "end_checklist": [
        "Ensure fmt/clippy/targeted tests pass; capture outputs in the session log",
        "Commit worktree changes and merge back to feat/settings-stack",
        "Update tasks.json + session_log.md with END entry",
        "Create/confirm S4-test kickoff prompt path is recorded"
      ],
      "depends_on": [
        "S3-integ"
      ],
      "concurrent_with": [
        "S4-test"
      ],
      "worktree": "wt/ss-s4-world-override-code",
      "integration_task": "S4-integ",
      "kickoff_prompt": "docs/project_management/next/settings-stack/kickoff_prompts/S4-code.md"
    },
    {
      "id": "S4-test",
      "name": "Test force world override",
      "type": "test",
      "phase": "Settings Stack",
      "status": "completed",
      "description": "Add tests validating the new --world override against disabled installs/config/env and confirm interaction with --no-world/caged settings.",
      "references": [
        "docs/project_management/next/settings-stack/settings_stack_plan.md",
        "crates/shell/src/lib.rs",
        "tests/installers/install_smoke.sh"
      ],
      "acceptance_criteria": [
        "Tests cover precedence: --world overrides disabled install/config/env; --no-world still disables isolation.",
        "Installer/config metadata assertions updated if needed to reflect the new flag behavior.",
        "No production code changes beyond minimal test scaffolding for this task."
      ],
      "start_checklist": [
        "Checkout feat/settings-stack, pull latest",
        "Set S4-test to in_progress, update session_log.md, commit docs update",
        "Create task branch ss-s4-world-override-test",
        "Create worktree wt/ss-s4-world-override-test from that branch",
        "Ensure git status is clean before editing tests"
      ],
      "end_checklist": [
        "Run fmt and targeted tests/scripts; capture outputs in the session log",
        "Commit worktree changes, merge back to feat/settings-stack, remove worktree",
        "Update tasks.json + session_log.md with END entry (commands/results/blockers)",
        "Create/confirm S4-integ kickoff prompt and reference prompts in the log"
      ],
      "depends_on": [
        "S3-integ"
      ],
      "concurrent_with": [
        "S4-code"
      ],
      "worktree": "wt/ss-s4-world-override-test",
      "integration_task": "S4-integ",
      "kickoff_prompt": "docs/project_management/next/settings-stack/kickoff_prompts/S4-test.md"
    },
    {
      "id": "S4-integ",
      "name": "Integrate force world override",
      "type": "integration",
      "phase": "Settings Stack",
      "status": "completed",
      "description": "Merge the force-world flag code + tests, resolve conflicts, and ensure fmt/clippy/tests and installer scenarios pass.",
      "references": [
        "docs/project_management/next/settings-stack/settings_stack_plan.md",
        "crates/shell",
        "scripts/substrate",
        "tests/installers"
      ],
      "acceptance_criteria": [
        "wt/ss-s4-world-override-integ merges code+tests with clean fmt/clippy/tests/installer smoke.",
        "feat/settings-stack updated with integration results and doc/task/log entries committed.",
        "Any follow-up kickoff prompts are recorded before ending the session."
      ],
      "start_checklist": [
        "Checkout feat/settings-stack, pull latest",
        "Confirm S4-code/test completed",
        "Set S4-integ to in_progress, update session_log.md, commit docs update",
        "Create task branch ss-s4-world-override-integ",
        "Create worktree wt/ss-s4-world-override-integ from that branch"
      ],
      "end_checklist": [
        "Merge code/test branches into integration branch/worktree and resolve conflicts",
        "Run required fmt/clippy/tests and installer smoke scenarios",
        "Merge integration branch back to feat/settings-stack and remove the worktree",
        "Update tasks.json + session_log.md with END entry; push or hand off"
      ],
      "depends_on": [
        "S4-code",
        "S4-test"
      ],
      "concurrent_with": [],
      "worktree": "wt/ss-s4-world-override-integ",
      "integration_task": null,
      "kickoff_prompt": "docs/project_management/next/settings-stack/kickoff_prompts/S4-integ.md"
    },
    {
      "id": "S5-code",
      "name": "Rename root to anchor + caged guard fix",
      "type": "code",
      "phase": "Settings Stack",
      "status": "completed",
      "description": "Rename the world root selector to anchor terminology (mode/path) while keeping backward compatibility, and fix caged enforcement for complex commands when the world is disabled.",
      "references": [
        "docs/project_management/next/settings-stack/settings_stack_plan.md",
        "docs/CONFIGURATION.md",
        "docs/USAGE.md",
        "crates/shell/src/lib.rs",
        "crates/shell/src/settings.rs",
        "scripts/substrate/dev-install-substrate.sh"
      ],
      "acceptance_criteria": [
        "CLI/env/config/installer metadata expose anchor_mode/anchor_path (with backward-compatible parsing of root_mode/root_path/envs/flags).",
        "Docs and CLI help reflect the anchor naming while noting compatibility.",
        "Caged root guard applies to complex commands (e.g., cd chains) even when world is disabled or unavailable.",
        "No regressions to world/caged precedence; code-only changes (tests handled separately)."
      ],
      "start_checklist": [
        "Checkout feat/settings-stack, pull latest",
        "Set S5-code to in_progress, update session_log.md, commit docs update",
        "Create task branch ss-s5-anchor-code",
        "Create worktree wt/ss-s5-anchor-code from that branch",
        "Ensure git status is clean before coding"
      ],
      "end_checklist": [
        "Ensure required fmt/lint/tests per prompt are green",
        "Commit worktree changes, merge back to feat/settings-stack, remove worktree",
        "Update tasks.json + session_log.md with END entry",
        "Create/confirm S5-test kickoff prompt path in the log"
      ],
      "depends_on": [
        "S4-integ"
      ],
      "concurrent_with": [
        "S5-test"
      ],
      "worktree": "wt/ss-s5-anchor-code",
      "integration_task": "S5-integ",
      "kickoff_prompt": "docs/project_management/next/settings-stack/kickoff_prompts/S5-code.md"
    },
    {
      "id": "S5-test",
      "name": "Test anchor naming + caged guard",
      "type": "test",
      "phase": "Settings Stack",
      "status": "in_progress",
      "description": "Add tests covering anchor naming compatibility and ensure caged enforcement applies to complex commands when the world is disabled or unavailable.",
      "references": [
        "docs/project_management/next/settings-stack/settings_stack_plan.md",
        "crates/shell/src/lib.rs",
        "crates/shell/src/settings.rs",
        "tests/installers/install_smoke.sh"
      ],
      "acceptance_criteria": [
        "Tests verify anchor_mode/anchor_path precedence and backward compatibility with root_mode/root_path env/config/flags.",
        "Tests cover caged guard behavior for complex commands (e.g., chained cd) with world disabled and enabled.",
        "Installer smoke expectations updated if metadata/env keys change.",
        "No production code changes beyond minimal test scaffolding."
      ],
      "start_checklist": [
        "Checkout feat/settings-stack, pull latest",
        "Set S5-test to in_progress, update session_log.md, commit docs update",
        "Create worktree wt/ss-s5-anchor-test from branch ss-s5-anchor-test",
        "Ensure git status is clean before editing tests"
      ],
      "end_checklist": [
        "Run required fmt/tests per prompt; capture outputs in session log",
        "Commit worktree changes, merge back to feat/settings-stack, remove worktree",
        "Update tasks.json + session_log.md with END entry (commands/results/blockers)",
        "Create/confirm S5-integ kickoff prompt path in the log"
      ],
      "depends_on": [
        "S4-integ"
      ],
      "concurrent_with": [
        "S5-code"
      ],
      "worktree": "wt/ss-s5-anchor-test",
      "integration_task": "S5-integ",
      "kickoff_prompt": "docs/project_management/next/settings-stack/kickoff_prompts/S5-test.md"
    },
    {
      "id": "S5-integ",
      "name": "Integrate anchor naming + caged guard",
      "type": "integration",
      "phase": "Settings Stack",
      "status": "pending",
      "description": "Merge the anchor naming/code changes and caged guard fixes with the test updates, resolve conflicts, and ensure fmt/clippy/tests and installer scenarios pass.",
      "references": [
        "docs/project_management/next/settings-stack/settings_stack_plan.md",
        "crates/shell",
        "tests/installers",
        "scripts/substrate"
      ],
      "acceptance_criteria": [
        "wt/ss-s5-anchor-integ merges code+tests with clean fmt/clippy/tests/installer smoke.",
        "feat/settings-stack updated with integration results and doc/task/log entries committed.",
        "Any follow-up kickoff prompts are recorded before ending the session."
      ],
      "start_checklist": [
        "Checkout feat/settings-stack, pull latest",
        "Confirm S5-code/test completed",
        "Set S5-integ to in_progress, update session_log.md, commit docs update",
        "Create task branch ss-s5-anchor-integ",
        "Create worktree wt/ss-s5-anchor-integ from that branch"
      ],
      "end_checklist": [
        "Merge code/test branches into integration branch/worktree and resolve conflicts",
        "Run required fmt/clippy/tests and installer smoke scenarios",
        "Merge integration branch back to feat/settings-stack and remove the worktree",
        "Update tasks.json + session_log.md with END entry; push or hand off"
      ],
      "depends_on": [
        "S5-code",
        "S5-test"
      ],
      "concurrent_with": [],
      "worktree": "wt/ss-s5-anchor-integ",
      "integration_task": null,
      "kickoff_prompt": "docs/project_management/next/settings-stack/kickoff_prompts/S5-integ.md"
    }
  ]
}
