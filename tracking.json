{
    "purpose": "Ad-hoc tracker for planning-system improvements.",
    "last_updated_utc": "2026-01-07T23:55:05Z",
    "items": [
        {
            "id": "HF-001",
            "area": "Standards consistency",
            "title": "Replace broken docs-edit sentinel phrase",
            "status": "completed",
            "result": "Canonical sentinel is `Do not edit planning docs inside the worktree.`; standards, lint, and existing Planning Packs updated."
        },
        {
            "id": "HF-002",
            "area": "Tooling / schema",
            "title": "Standardize tasks.json to object-with-tasks array",
            "status": "completed",
            "result": "All Planning Packs under `docs/project_management/next/*` now use `{ \"tasks\": [...] }`."
        },
        {
            "id": "HF-003",
            "area": "Standards consistency",
            "title": "Fix worktree path prefix mismatch",
            "status": "completed",
            "result": "`worktree` is treated as a full path; `git worktree add <worktree> <branch>` is the canonical instruction."
        },
        {
            "id": "HF-004",
            "area": "Integration gate",
            "title": "Add fast integration check target",
            "status": "completed",
            "result": "Added `make integ-checks` (no `cargo clean`, clippy uses `-D warnings`) and updated triad standards to use it."
        },
        {
            "id": "HF-005",
            "area": "Standards / tooling mismatch",
            "title": "Make lint checklist reflect lint runners",
            "status": "completed",
            "result": "`docs/project_management/standards/PLANNING_LINT_CHECKLIST.md` now instructs running `scripts/planning/lint.sh` / `scripts/planning/lint.ps1` (single source of truth)."
        },
        {
            "id": "P0-001",
            "area": "Validation",
            "title": "Add canonical tasks.json validator + JSON Schema",
            "status": "completed",
            "files": [
                "scripts/planning/validate_tasks_json.py",
                "docs/project_management/standards/tasks.schema.json"
            ]
        },
        {
            "id": "P1-001",
            "area": "Automation",
            "title": "Add planning lint runner scripts",
            "status": "completed",
            "files": [
                "scripts/planning/lint.sh",
                "scripts/planning/lint.ps1"
            ]
        },
        {
            "id": "P1-002",
            "area": "Automation",
            "title": "Add feature Planning Pack scaffolder",
            "status": "completed",
            "files": [
                "scripts/planning/new_feature.sh",
                "scripts/planning/new_feature.ps1",
                "docs/project_management/standards/templates/"
            ]
        },
        {
            "id": "P2-001",
            "area": "Drift prevention",
            "title": "Introduce per-feature contract surface file",
            "status": "completed",
            "files": ["docs/project_management/standards/CONTRACT_SURFACE_STANDARD.md"]
        },
        {
            "id": "P2-002",
            "area": "Parallel integration",
            "title": "Add platform-specific integration model + GitHub Actions support",
            "status": "completed",
            "files": [
                "docs/project_management/standards/PLATFORM_INTEGRATION_AND_CI.md",
                ".github/workflows/feature-smoke.yml",
                "scripts/ci/dispatch_feature_smoke.sh"
            ],
            "notes": "WSL smoke is supported via a self-hosted runner stub; hosted-runner WSL is not assumed."
        },
        {
            "id": "P2-003",
            "area": "Drift prevention",
            "title": "Embed ADR executive summary + drift guard",
            "status": "completed",
            "files": [
                "docs/project_management/standards/EXECUTIVE_SUMMARY_STANDARD.md",
                "docs/project_management/standards/ADR_STANDARD_AND_TEMPLATE.md",
                "scripts/planning/check_adr_exec_summary.py",
                "docs/project_management/next/ADR-0002-world-deps-install-classes-and-world-provisioning.md",
                "docs/project_management/next/ADR-0003-policy-and-config-mental-model-simplification.md",
                "docs/project_management/next/ADR-0003-policy-and-config-mental-model-simplification_OG.md",
                "docs/project_management/next/ADR-0004-world-overlayfs-directory-enumeration-reliability.md",
                "docs/project_management/next/p0-agent-hub-isolation-hardening/ADR-0001-agent-hub-runtime-config-and-isolation.md"
            ],
            "notes": "Exec summaries include Existing→New→Why + Links, and `ADR_BODY_SHA256` enforces summary/body sync."
        },
        {
            "id": "P2-005",
            "area": "Planning pack ergonomics",
            "title": "Introduce per-slice directory layout (v3) to reduce clutter and improve auditability",
            "status": "planned",
            "proposal": {
                "current_layout": {
                    "feature_root": [
                        "plan.md",
                        "tasks.json",
                        "session_log.md",
                        "contract.md",
                        "C0-spec.md",
                        "kickoff_prompts/*.md",
                        "smoke/*"
                    ]
                },
                "proposed_layout_v3": {
                    "feature_root": [
                        "plan.md",
                        "tasks.json",
                        "session_log.md",
                        "contract.md",
                        "decision_register.md (if decision-heavy/cross-platform)",
                        "integration_map.md (if decision-heavy/cross-platform)",
                        "manual_testing_playbook.md (if decision-heavy/cross-platform)",
                        "smoke/ (feature-level smoke scripts; optionally add slice-specific subfolders only when needed)"
                    ],
                    "slices_directory": "slices/<SLICE_ID>/",
                    "slice_contents": [
                        "slices/C0/spec.md (canonical slice spec, replaces C0-spec.md)",
                        "slices/C0/kickoff/code.md",
                        "slices/C0/kickoff/test.md",
                        "slices/C0/kickoff/integ-core.md",
                        "slices/C0/kickoff/integ-linux.md",
                        "slices/C0/kickoff/integ-macos.md",
                        "slices/C0/kickoff/integ-windows.md",
                        "slices/C0/kickoff/integ-wsl.md (only when meta.wsl_required && meta.wsl_task_mode == 'separate')",
                        "slices/C0/artifacts/ (optional: CI run URLs, logs, screenshots, manual test notes)"
                    ],
                    "task_id_mapping": {
                        "C0-code": "slices/C0/kickoff/code.md",
                        "C0-test": "slices/C0/kickoff/test.md",
                        "C0-integ-core": "slices/C0/kickoff/integ-core.md",
                        "C0-integ-linux": "slices/C0/kickoff/integ-linux.md",
                        "C0-integ-macos": "slices/C0/kickoff/integ-macos.md",
                        "C0-integ-windows": "slices/C0/kickoff/integ-windows.md",
                        "C0-integ-wsl": "slices/C0/kickoff/integ-wsl.md",
                        "C0-integ": "slices/C0/kickoff/integ-final.md"
                    }
                }
            },
            "required_work": {
                "standards_and_docs": [
                    "Update docs/project_management/standards/PLANNING_README.md to describe the v3 layout and migration strategy.",
                    "Update docs/project_management/standards/TASK_TRIADS_AND_FEATURE_SETUP.md to reference per-slice locations (spec + kickoff prompts).",
                    "Update docs/project_management/standards/PLANNING_LINT_CHECKLIST.md to validate the new locations (and continue to support v2/v1 packs)."
                ],
                "tooling_changes": [
                    "Update scripts/planning/new_feature.sh and scripts/planning/new_feature.ps1 to scaffold v3 layout.",
                    "Update scripts/planning/validate_tasks_json.py to accept and/or enforce v3 layout when opted in (e.g., meta.schema_version >= 3 or meta.layout_version='v3').",
                    "Update scripts/planning/lint.sh and scripts/planning/lint.ps1 (and any other linters) to locate specs/kickoff prompts in per-slice directories.",
                    "Update scripts/planning/ensure_kickoff_prompt_sentinel.py and any path-based checks to discover kickoff prompts under slices/**/kickoff/."
                ],
                "repo_wide_reference_updates": [
                    "Run comprehensive searches to replace hard-coded references to C0-spec.md, kickoff_prompts/, and feature-root spec conventions.",
                    "Search locations: docs/project_management/standards/**, scripts/planning/**, scripts/ci/**, and any examples in docs/project_management/next/**.",
                    "Add guardrails to prevent partial migrations (e.g., a validator error if some tasks reference v2 paths while others use v3 paths under the same feature)."
                ],
                "migration_strategy": [
                    "Do not break existing Planning Packs: make v3 opt-in via an explicit meta flag/version.",
                    "Optionally add a one-shot migrator script that converts a v2 feature pack to v3 and updates tasks.json references."
                ]
            },
            "notes": "Defer until after current WSL/platform-fix workflow changes land; this is a structural migration that requires careful repo-wide reference updates."
        },
        {
            "id": "P2-006",
            "area": "Execution drift prevention",
            "title": "Add feature start preflight gate + per-slice closeout gate (smoke↔manual parity + no-drift evidence)",
            "status": "completed",
            "files": [
                "docs/project_management/standards/EXECUTION_PREFLIGHT_GATE_STANDARD.md",
                "docs/project_management/standards/SLICE_CLOSEOUT_GATE_STANDARD.md",
                "docs/project_management/standards/templates/execution_preflight_report.md.tmpl",
                "docs/project_management/standards/templates/slice_closeout_report.md.tmpl",
                "docs/project_management/standards/templates/kickoff_exec_preflight.md.tmpl",
                "docs/project_management/standards/TASK_TRIADS_AND_FEATURE_SETUP.md",
                "docs/project_management/standards/PLANNING_WORKFLOW_OVERVIEW.md",
                "docs/project_management/standards/PLANNING_README.md",
                "docs/project_management/standards/PLANNING_LINT_CHECKLIST.md",
                "scripts/planning/new_feature.sh",
                "scripts/planning/new_feature.ps1",
                "scripts/planning/validate_tasks_json.py",
                "docs/project_management/standards/tasks.schema.json"
            ],
            "notes": "Scaffolders now generate an ops task `F0-exec-preflight`, `execution_preflight_report.md`, and per-slice `<SLICE>-closeout_report.md`. Validator enforces these only when tasks.json opts in via `meta.execution_gates: true`."
        },
        {
            "id": "P2-007",
            "area": "Automation / reproducibility",
            "title": "Add Makefile targets for planning gates and cross-platform smoke dispatch",
            "status": "completed",
            "files": [
                "Makefile",
                "scripts/planning/lint.sh",
                "scripts/planning/validate_tasks_json.py",
                "scripts/planning/check_adr_exec_summary.py",
                "scripts/ci/dispatch_feature_smoke.sh"
            ],
            "notes": "Introduces canonical `make planning-lint`, `make planning-lint-ps`, `make planning-validate`, `make adr-check`, and `make feature-smoke` wrappers to reduce flag/path drift in automated gates."
        },
        {
            "id": "P2-008",
            "area": "Automation / reproducibility",
            "title": "Add Makefile targets for Planning Pack scaffolding",
            "status": "completed",
            "files": [
                "Makefile",
                "scripts/planning/new_feature.sh",
                "scripts/planning/new_feature.ps1"
            ],
            "notes": "Adds `make planning-new-feature` (bash) and `make planning-new-feature-ps` (pwsh) wrappers with variables for cross-platform/WSL flags, and runs tasks.json validation automatically."
        },
        {
            "id": "P2-009",
            "area": "Automation / execution workflow",
            "title": "Add task-runner + task-finish scripts (worktree lifecycle + headless Codex execution) and a feature cleanup task",
            "status": "completed",
            "files": [
                "scripts/triad/orch_ensure.sh",
                "scripts/triad/task_start.sh",
                "scripts/triad/task_start_pair.sh",
                "scripts/triad/task_finish.sh",
                "scripts/triad/feature_cleanup.sh",
                "Makefile",
                "docs/project_management/standards/TASK_TRIADS_AND_FEATURE_SETUP.md",
                "docs/project_management/standards/TRIAD_WORKFLOW_CROSS_PLATFORM_INTEG.md",
                "docs/project_management/standards/tasks.schema.json",
                "scripts/planning/validate_tasks_json.py",
                "scripts/planning/new_feature.sh",
                "scripts/planning/new_feature.ps1",
                "docs/project_management/standards/templates/"
            ],
            "goal": "Reduce git/worktree ceremony and improve reproducibility by standardizing task branch/worktree creation and launching the agent from inside the worktree with the correct kickoff prompt; keep final merging discipline aligned to the triad model.",
            "design": {
                "scripts": [
                    "scripts/triad/orch_ensure.sh (runs on orchestration worktree; ensures orchestration branch exists locally; fetches/creates/pushes as needed; ff-only pull)",
                    "scripts/triad/task_start.sh (runs on orchestration branch; creates/updates task branch + worktree; prints kickoff prompt path; optionally launches codex headless inside the worktree)",
                    "scripts/triad/task_start_pair.sh (runs on orchestration branch; starts code+test tasks for a slice together; optionally launches codex headless for both in parallel)",
                    "scripts/triad/task_finish.sh (runs from inside the task worktree; verifies required checks were run and/or runs them; commits; prints summary; does NOT delete worktree)",
                    "scripts/triad/feature_cleanup.sh (runs at end of feature; removes all task worktrees + optionally prunes task branches)"
                ],
                "cli_contract": {
                    "task_start": {
                        "required_args": ["--feature-dir <path>", "--task-id <id>"],
                        "optional_args": [
                            "--launch-codex",
                            "--codex-profile <profile>",
                            "--codex-model <model>",
                            "--codex-jsonl (captures `codex exec --json` output to a file)",
                            "--platform <linux|macos|windows|wsl> (for platform-fix tasks)",
                            "--dry-run"
                        ],
                        "stdout_contract": [
                            "WORKTREE=<path>",
                            "TASK_BRANCH=<branch>",
                            "ORCH_BRANCH=<branch>",
                            "KICKOFF_PROMPT=<path>",
                            "NEXT=<recommended next command>"
                        ]
                    },
                    "task_start_pair": {
                        "required_args": ["--feature-dir <path>", "--slice-id <slice>|--code-task-id <id> --test-task-id <id>"],
                        "optional_args": [
                            "--launch-codex",
                            "--codex-profile <profile>",
                            "--codex-model <model>",
                            "--codex-jsonl",
                            "--dry-run"
                        ],
                        "stdout_contract": [
                            "ORCH_BRANCH=<branch>",
                            "CODE_TASK_ID=<id>",
                            "TEST_TASK_ID=<id>",
                            "CODE_WORKTREE=<path>",
                            "TEST_WORKTREE=<path>",
                            "CODE_TASK_BRANCH=<branch>",
                            "TEST_TASK_BRANCH=<branch>",
                            "CODEX_CODE_EXIT=<code or empty>",
                            "CODEX_TEST_EXIT=<code or empty>"
                        ]
                    },
                    "task_finish": {
                        "required_args": ["--task-id <id>"],
                        "optional_args": [
                            "--verify-only",
                            "--no-commit (for investigation-only runs)",
                            "--platform <linux|macos|windows|wsl>",
                            "--smoke (run make feature-smoke for platform-fix tasks)",
                            "--dry-run"
                        ],
                        "stdout_contract": [
                            "TASK_BRANCH=<branch>",
                            "WORKTREE=<path>",
                            "HEAD=<sha>",
                            "COMMITS=<count>",
                            "CHECKS=<what ran / verified>",
                            "SMOKE_RUN=<run id/url if executed>",
                            "MERGED_TO_ORCH=<true|false|empty>"
                        ]
                    },
                    "feature_cleanup": {
                        "required_args": ["--feature-dir <path>"],
                        "optional_args": [
                            "--remove-worktrees",
                            "--prune-local-branches",
                            "--prune-remote-branches <remote>",
                            "--force (required to delete dirty worktrees or branches with unpushed commits)",
                            "--dry-run"
                        ],
                        "stdout_contract": [
                            "REMOVED_WORKTREES=<count>",
                            "PRUNED_LOCAL_BRANCHES=<count>",
                            "PRUNED_REMOTE_BRANCHES=<count>"
                        ]
                    }
                },
                "merge_policy": {
                    "code_test_tasks": "task_finish commits to the task branch; integration tasks are responsible for merging code/test branches into integration worktrees (no auto-merge to orchestration from code/test).",
                    "integration_tasks": "task_finish may optionally fast-forward merge the integration branch back to orchestration (safe FF-only). Any conflicts must be resolved explicitly in the integration worktree."
                },
                "worktree_retention": {
                    "policy": "Worktrees are retained throughout the feature to allow reach-back debugging; they are removed only by a feature-level cleanup task at the end of the feature.",
                    "mechanism": "Introduce a dedicated ops task at feature end (e.g., `FZ-feature-cleanup`) with a kickoff prompt that runs `scripts/triad/feature_cleanup.sh`."
                },
                "task_metadata": {
                    "worktree_marker": "Write a small `.taskmeta.json` file at the root of each worktree containing: { task_id, feature_dir, orchestration_branch, task_branch, created_from_sha, created_at_utc }.",
                    "feature_registry": {
                        "intent": "Feature cleanup must be deterministic (no guessing by scanning).",
                        "proposal": [
                            "Write/update a feature registry file (e.g., `docs/project_management/next/<feature>/.worktrees.json`) listing all known task worktrees/branches, last updated UTC, and whether each worktree is clean.",
                            "task_start registers; task_finish updates status; feature_cleanup consumes the registry."
                        ],
                        "notes": "If a feature directory should remain pure-docs, store the registry in `target/triad/<feature>/.worktrees.json` and link it from the feature docs. Decide and document one canonical location."
                    },
                    "guardrails": [
                        "Refuse to operate if git status is dirty in the wrong place (orchestration vs worktree).",
                        "Refuse to merge if not FF-only (integration finish only).",
                        "Refuse to finish if the worktree does not contain a matching `.taskmeta.json`.",
                        "Refuse to start if the target worktree path already exists but points to the wrong branch/feature."
                    ]
                },
                "naming_rules": {
                    "goal": "No ad-hoc naming; mapping must be deterministic.",
                    "proposal": [
                        "Primary source: tasks.json fields `worktree`, `kickoff_prompt`, and a new optional `git_branch` field (opt-in automation).",
                        "Fallback: derive branch/worktree from task id using a single transform (e.g., `C0-code` -> `c0-code`; `C0-integ-linux` -> `c0-integ-linux`; worktree `wt/<feature>-<branch>`).",
                        "Enforce a single canonical feature prefix (from tasks.json meta.feature or directory basename)."
                    ]
                },
                "required_task_fields": {
                    "problem": "Automation needs a structured way to derive branch/worktree/kickoff/spec per task. Parsing start_checklist text is too brittle.",
                    "proposal": [
                        "Extend tasks.json schema with optional structured fields for automation (e.g., `git_branch`, `orchestration_branch`, `slice_id`, `role`, `required_make_targets`, `merge_to_orchestration`).",
                        "Keep it opt-in (e.g., `meta.schema_version >= 3` or `meta.automation: true`) to avoid breaking existing packs.",
                        "Update scaffolders to populate these fields for new packs."
                    ]
                },
                "checks_integration": {
                    "idea": "task_finish should verify required commands were run/recorded and/or run them via canonical make targets.",
                    "examples": [
                        "code: `make fmt` / `make clippy` (or keep as `make integ-checks` only for integration; decide target set)",
                        "integration: `make integ-checks`",
                        "platform-fix: `make feature-smoke FEATURE_DIR=... PLATFORM=... [RUN_WSL=1]`"
                    ],
                    "note": "Prefer verifying/recording over enforcing too strictly at first; tighten later once stable.",
                    "evidence_recording": {
                        "min_requirement": "Scripts must print a machine-parseable summary to stdout and instruct the operator to paste it into the session_log END entry.",
                        "nice_to_have": "Optionally append a short standardized block into `docs/project_management/next/<feature>/session_log.md` via orchestration branch only (never from within a worktree)."
                    }
                },
                "codex_headless_launch": {
                    "intent": "task_start should be able to launch Codex headless from inside the worktree using the kickoff prompt as the initial instruction, so the agent begins in the correct directory with minimal human steps.",
                    "mcp_research_required": "Use DeepWiki MCP (`openai/codex`) to confirm flags and behavior for headless mode.",
                    "expected_invocation_shape": [
                        "Start from the worktree: `codex exec --cd <worktree> ...`",
                        "Pass the kickoff prompt via stdin: `codex exec ... - < <kickoff_prompt.md>`",
                        "Ensure non-interactive execution for scripting (e.g., JSONL output when needed)."
                    ],
                    "flags_to_confirm": [
                        "No approvals / non-interactive: `--dangerously-bypass-approvals-and-sandbox` (required for scripting automation)",
                        "Working directory: `--cd` / `-C`",
                        "Prompt from stdin: omit prompt arg or use `-`",
                        "Output shaping: `--json`, `--output-last-message <file>` (and any schema/output options)",
                        "Danger bypass: `--dangerously-bypass-approvals-and-sandbox`"
                    ],
                    "minimum_viable_behavior": [
                        "Detect codex binary presence; if missing, print an actionable error.",
                        "Refuse to launch if the worktree does not exist or lacks `.taskmeta.json`.",
                        "Write the final assistant message to a file under the worktree (or a feature-level artifacts dir) for auditing.",
                        "Emit JSONL events when running in CI-like automation mode (optional flag).",
                        "Propagate codex exit code as the script exit code so automation can detect failures."
                    ],
                    "note": "We must ensure the headless invocation runs without interactive approvals and behaves deterministically for automation; document all flags and defaults."
                }
            },
            "docs_and_tooling_updates_required": [
                "Update docs/project_management/standards/TASK_TRIADS_AND_FEATURE_SETUP.md to describe task_start/task_finish/feature_cleanup workflows.",
                "Update kickoff prompt templates to reference the task scripts (and canonical make targets) rather than manual git steps.",
                "Update scripts/planning/new_feature.* to scaffold the cleanup task and any required structured task fields when automation is enabled.",
                "Update scripts/planning/validate_tasks_json.py and lint runners to enforce the new automation shape only when opted in.",
                "Add Makefile targets to wrap task_start/task_finish/feature_cleanup for consistency.",
                "Add explicit documentation for branch/worktree naming conventions so humans can reason about state without reading script source."
            ]
        },
        {
            "id": "P2-004",
            "area": "Sequencing / dependencies",
            "title": "Fix missing sprints and cross-feature deps",
            "status": "completed",
            "files": [
                "docs/project_management/next/sequencing.json",
                "docs/project_management/next/world_deps_selection_layer/tasks.json",
                "docs/project_management/next/world-sync/tasks.json"
            ],
            "notes": "Added missing sprint entries (incl. `p0_platform_stability`, `p0_platform_stability_macos_parity`, `world_deps_selection_layer`) and declared cross-feature task deps via `meta.external_task_ids`."
        },
        {
            "id": "P3-001",
            "area": "CI / parity preflight",
            "title": "Catch cross-platform compile breaks before smoke dispatch",
            "status": "open",
            "scope": "Triad integration-core workflow (pre-smoke).",
            "problem": "Cross-platform CI failures were discovered only after dispatching CI runs, costing runner time and creating iterative thrash.",
            "evidence": {
                "feature": "world-overlayfs-enumeration",
                "ci_testing_pre_final": {
                    "run_id": "20763974819",
                    "run_url": "https://github.com/atomize-hq/substrate/actions/runs/20763974819",
                    "summary_file": "target/triad/orch-wrapper/WO0-ci-testing-pre-final.log",
                    "symptoms": [
                        "macOS + Windows builds failed while Linux passed",
                        "Example errors include: error[E0599] (missing mount_kernel_only/mount_fuse_only), error[E0277] ([u8] unsized)"
                    ],
                    "log_snippet": [
                        "error[E0599]: no method named `mount_kernel_only` found for struct `overlayfs::OverlayFs` in the current scope",
                        "error[E0599]: no method named `mount_fuse_only` found for struct `overlayfs::OverlayFs` in the current scope",
                        "error[E0277]: the size for values of type `[u8]` cannot be known at compilation time"
                    ],
                    "how_to_retrieve_logs": [
                        "gh run view 20763974819 --repo atomize-hq/substrate --log-failed",
                        "gh run view 20763974819 --repo atomize-hq/substrate --json conclusion,status,url,jobs"
                    ]
                }
            },
            "root_cause_hypothesis": [
                "Linux-only logic was not fully cfg-gated, so non-Linux targets tried to compile Linux-only symbols/methods.",
                "These errors were only surfaced when CI compiled on macOS/Windows."
            ],
            "proposed_fix": {
                "behavior": "Before dispatching Feature Smoke (or CI testing), run a deterministic cross-platform 'compile parity' preflight and fail fast with actionable output.",
                "candidates": [
                    "Add a make target (or script) that runs minimal cross-platform compilation checks (e.g., cargo check/clippy with cfg gates verified) prior to dispatch.",
                    "If full cross-platform compilation is not possible locally, run the parity preflight in CI-testing workflow earlier and gate downstream steps."
                ],
                "acceptance_criteria": [
                    "Integration-core fails before dispatching platform smoke when macOS/Windows would fail to compile",
                    "Failure output includes the first 1-3 compiler errors and points to likely cfg-gating surfaces",
                    "One dispatch attempt is sufficient; no repeat dispatch loops required to surface the same issue"
                ]
            },
            "sources": [
                "target/triad/orch-wrapper/WO0-ci-testing-pre-final.log",
                "target/triad/orch-wrapper/WO0-ci-testing-pre-final.from-integ-core.log",
                "scripts/ci/dispatch_ci_testing.sh"
            ]
        },
        {
            "id": "P3-002",
            "area": "CI / self-hosted runner provisioning",
            "title": "Linux self-hosted smoke fails due to /run/substrate.sock permissions",
            "status": "open",
            "problem": "Linux smoke failures were caused by runner environment permissions rather than repo changes; this triggered repeated smoke dispatches and consumed agent time.",
            "evidence": {
                "feature": "world-overlayfs-enumeration",
                "feature_smoke": {
                    "run_id": "20764936549",
                    "run_url": "https://github.com/atomize-hq/substrate/actions/runs/20764936549",
                    "symptom": "substrate world doctor: socket activation probe failed for /run/substrate.sock (Permission denied (os error 13))",
                    "log_snippet": "linux_self_hosted ... substrate world doctor: socket activation probe failed for /run/substrate.sock (Permission denied (os error 13))",
                    "how_to_retrieve_logs": [
                        "gh run view 20764936549 --repo atomize-hq/substrate --log-failed | rg -n 'substrate\\.sock|Permission denied'",
                        "gh run view 20764936549 --repo atomize-hq/substrate --log-failed | head -n 2500"
                    ]
                },
                "codex_logs": [
                    {
                        "file": "target/triad/world-overlayfs-enumeration/codex/WO0-integ-core/stderr.log",
                        "example_excerpt_lines": "See lines ~430-460 for dispatch output and RUN_ID; see later occurrences of Permission denied for linux_self_hosted job failures."
                    },
                    {
                        "file": "target/triad/world-overlayfs-enumeration/codex/WO0-integ-linux/last_message.md",
                        "note": "Contains operator handoff guidance pointing to runner group membership + socket perms."
                    }
                ]
            },
            "root_cause_hypothesis": [
                "Runner user lacks group membership (expected: `substrate`) or systemd socket permissions for `/run/substrate.sock`.",
                "Even if group membership is added, the runner service must be restarted to pick up the new group list."
            ],
            "proposed_fix": {
                "behavior": [
                    "Add a fast runner-side preflight (before running smoke) that checks socket existence and access and fails with a clear 'runner misprovisioned' message.",
                    "Stop retrying smoke on this class of failure; print a single remediation block."
                ],
                "remediation_block_template": [
                    "Verify runner user is in `substrate` group",
                    "Restart runner service (or reboot) so new group membership applies",
                    "Confirm `/run/substrate.sock` is `root:substrate` and `0660` and the runner user is in `substrate`"
                ],
                "acceptance_criteria": [
                    "Linux smoke fails with an explicit provisioning diagnosis rather than a generic command failure",
                    "Operator action required is unambiguous and single-step (no repeated dispatch guessing)"
                ]
            },
            "sources": [
                ".github/workflows/feature-smoke.yml",
                "scripts/ci/dispatch_feature_smoke.sh",
                "target/triad/orch-wrapper/WO0-platform-fixes-from-smoke.make.log"
            ]
        },
        {
            "id": "P3-003",
            "area": "CI dispatch ergonomics",
            "title": "feature-smoke dispatch returns exit 2 after successful dispatch, causing rerun thrash",
            "status": "completed",
            "problem": "Operators/agents treated `make feature-smoke` as 'failed to dispatch' because it exited non-zero even though it successfully dispatched and printed RUN_ID/RUN_URL.",
            "evidence": {
                "feature": "world-overlayfs-enumeration",
                "codex_log": {
                    "file": "target/triad/world-overlayfs-enumeration/codex/WO0-integ-core/stderr.log",
                    "excerpt": [
                        "make feature-smoke ... exited 2",
                        "RUN_ID=20764342990",
                        "RUN_URL=https://github.com/atomize-hq/substrate/actions/runs/20764342990"
                    ],
                    "excerpt_location_hint": "See line-numbered excerpt around 440-460."
                },
                "dispatcher": {
                    "script": "scripts/ci/dispatch_feature_smoke.sh",
                    "stdout_contract": [
                        "DISPATCH_OK=0|1",
                        "HEAD=<sha>",
                        "TEMP_BRANCH=<branch>",
                        "RUN_ID=<id>",
                        "RUN_URL=<url or empty>",
                        "CONCLUSION=<conclusion>",
                        "SMOKE_PASSED_PLATFORMS=<csv or empty>",
                        "SMOKE_FAILED_PLATFORMS=<csv or empty>"
                    ],
                    "observed_behavior": "Non-zero exit is used for 'run concluded failure' (not only dispatch failures), but this is easy to misinterpret when output still contains a valid RUN_ID."
                }
            },
            "proposed_fix": {
                "behavior": [
                    "Make dispatcher output explicitly separate 'dispatch succeeded' from 'run failed'.",
                    "Return a unique exit code (or print a machine-parseable field) that distinguishes dispatch failure vs run failure (e.g., `DISPATCH_OK=1`).",
                    "Emit a one-screen 'next step' block (view run URL; classify failure; select platform-fix tasks) to reduce repeated blind reruns."
                ],
                "acceptance_criteria": [
                    "Agents do not rerun feature-smoke repeatedly just to obtain a run id",
                    "Orchestration wrapper can unambiguously decide whether to launch platform-fix tasks based on machine-parseable fields"
                ]
            },
            "result": {
                "behavior": [
                    "The dispatcher always emits a full machine-parseable summary (even on timeouts/query failures) via an EXIT trap, including `DISPATCH_OK`, `RUN_ID`, `RUN_URL`, `CONCLUSION`, and `ERROR_KIND`/`ERROR_MESSAGE`.",
                    "When invoked via `make feature-smoke`, GNU make still exits 2 on any recipe failure; docs now explicitly instruct relying on `DISPATCH_OK=1` + `RUN_URL` to confirm dispatch succeeded and avoid reruns.",
                    "Kickoff prompt template now calls out the make exit-code behavior to reduce agent/operator confusion."
                ],
                "files_updated": [
                    "scripts/ci/dispatch_feature_smoke.sh",
                    "docs/project_management/standards/PLATFORM_INTEGRATION_AND_CI.md",
                    "docs/project_management/standards/templates/kickoff_integ_core.md.tmpl"
                ]
            },
            "related_friction": {
                "gh_json_field_drift": {
                    "symptom": "gh run view JSON field mismatch (`htmlURL` invalid) caused a dead-end command attempt",
                    "evidence": "target/triad/world-overlayfs-enumeration/codex/WO0-integ-core/stderr.log (Unknown JSON field: \"htmlURL\")",
                    "idea": "Prefer stable `url` field and/or wrap gh calls in a repo script so agents don't guess field names."
                }
            },
            "sources": [
                "scripts/ci/dispatch_feature_smoke.sh",
                "docs/project_management/standards/PLATFORM_INTEGRATION_AND_CI.md",
                "docs/project_management/standards/templates/kickoff_integ_core.md.tmpl",
                "target/triad/world-overlayfs-enumeration/codex/WO0-integ-core/stderr.log"
            ]
        },
        {
            "id": "P3-004",
            "area": "Planning pack / kickoff prompts",
            "title": "Integration-core/platform-fix kickoff prompts existed only in worktrees (not orchestration branch)",
            "status": "open",
            "problem": "Some kickoff prompt files used by automation were not present under the orchestration branch Planning Pack directory, reducing auditability and making it harder to reproduce runs from the planning pack alone.",
            "evidence": {
                "orchestration_pack_prompts": "docs/project_management/next/world-overlayfs-enumeration/kickoff_prompts/ (WO0-code, WO0-test, WO0-integ, plus gate/cleanup)",
                "worktree_only_prompts": [
                    "wt/woe-wo0-integ-core/docs/project_management/next/world-overlayfs-enumeration/kickoff_prompts/WO0-integ-core.md",
                    "wt/woe-wo0-integ-core/docs/project_management/next/world-overlayfs-enumeration/kickoff_prompts/WO0-integ-linux.md",
                    "wt/woe-wo0-integ-core/docs/project_management/next/world-overlayfs-enumeration/kickoff_prompts/WO0-integ-macos.md",
                    "wt/woe-wo0-integ-core/docs/project_management/next/world-overlayfs-enumeration/kickoff_prompts/WO0-integ-windows.md"
                ],
                "tasks_json_references": "docs/project_management/next/world-overlayfs-enumeration/tasks.json references kickoff_prompt paths for WO0-integ-core/platform-fix tasks."
            },
            "proposed_fix": {
                "behavior": [
                    "If tasks.json references a kickoff prompt path, it must exist in the orchestration branch planning pack.",
                    "Planning lint should fail if a referenced kickoff prompt does not exist in `docs/project_management/next/<feature>/kickoff_prompts/`."
                ],
                "acceptance_criteria": [
                    "All automation-started tasks have their kickoff prompts present in the planning pack on the orchestration branch",
                    "Worktree-local copies are treated as derived, not source-of-truth"
                ]
            },
            "sources": [
                "docs/project_management/next/world-overlayfs-enumeration/tasks.json",
                "docs/project_management/next/world-overlayfs-enumeration/kickoff_prompts/",
                "wt/woe-wo0-integ-core/docs/project_management/next/world-overlayfs-enumeration/kickoff_prompts/"
            ]
        },
        {
            "id": "P3-005",
            "area": "Kickoff prompt ergonomics",
            "title": "Relative-path doc references in prompts caused wasted cycles (missing plan.md/tasks.json/session_log.md)",
            "status": "open",
            "problem": "Kickoff prompts used bare filenames (plan.md/tasks.json/session_log.md) which fail when executed from repo root worktrees, causing agents to waste time locating the correct paths.",
            "evidence": {
                "codex_log": {
                    "file": "target/triad/world-overlayfs-enumeration/codex/WO0-integ-linux/stderr.log",
                    "excerpt": [
                        "sed: can't read plan.md: No such file or directory",
                        "cat: tasks.json: No such file or directory",
                        "sed: can't read session_log.md: No such file or directory"
                    ],
                    "excerpt_location_hint": "See line-numbered excerpt around 99-106."
                },
                "prompt_text": "WO0-integ-linux prompt says: 'Read: plan.md, tasks.json, session_log.md, spec, and this prompt.'"
            },
            "proposed_fix": {
                "behavior": [
                    "Kickoff prompt templates must reference planning-pack artifacts via full paths or via a declared `FEATURE_DIR` variable (preferred).",
                    "Recommend a standard header block in every kickoff prompt: `FEATURE_DIR=\"docs/project_management/next/<feature>\"` and then `$FEATURE_DIR/plan.md`, etc."
                ],
                "acceptance_criteria": [
                    "No kickoff prompt requires guesswork about which directory contains plan/tasks/session log",
                    "Agents can copy/paste commands without path corrections"
                ]
            },
            "sources": [
                "target/triad/world-overlayfs-enumeration/codex/WO0-integ-linux/stderr.log",
                "docs/project_management/next/world-overlayfs-enumeration/kickoff_prompts/"
            ]
        },
        {
            "id": "P3-006",
            "area": "Integration merge safety",
            "title": "Planning docs merge conflicts (tasks.json) during integration final",
            "status": "open",
            "problem": "Integration final hit merge conflicts in planning artifacts (tasks.json), contrary to the expectation that planning docs are edited only on orchestration branch and should be identical across branches.",
            "evidence": {
                "codex_log": {
                    "file": "target/triad/world-overlayfs-enumeration/codex/WO0-integ/stderr.log",
                    "excerpt": [
                        "Auto-merging docs/project_management/next/world-overlayfs-enumeration/tasks.json",
                        "CONFLICT (content): Merge conflict in docs/project_management/next/world-overlayfs-enumeration/tasks.json"
                    ],
                    "excerpt_location_hint": "See line-numbered excerpt around 758-760."
                },
                "triad_context": "Automation creates/updates planning files (e.g., task statuses) on orchestration branch, while worktrees may carry earlier copies."
            },
            "proposed_fix": {
                "behavior": [
                    "Ensure task branches never introduce diffs under `docs/project_management/next/<feature>/` (beyond derived copies).",
                    "In integration merges, automatically take planning-pack files from orchestration branch (or explicitly exclude them from merges) to avoid conflicts."
                ],
                "acceptance_criteria": [
                    "Integration merges are conflict-free for planning-pack files by construction",
                    "triad-task-finish does not require humans to resolve planning-doc conflicts"
                ]
            },
            "sources": [
                "target/triad/world-overlayfs-enumeration/codex/WO0-integ/stderr.log",
                "docs/project_management/standards/TASK_TRIADS_WORKTREE_EXECUTION_STANDARD.md"
            ]
        },
        {
            "id": "P3-007",
            "area": "Runner toolchain stability",
            "title": "Self-hosted Linux runner shows rustup/system Rust conflict noise",
            "status": "open",
            "problem": "Runner setup emitted confusing rustup installer errors/warnings (even if ignorable), increasing cognitive load and making it harder to spot real failures.",
            "evidence": {
                "feature_smoke_run_id": "20764936549",
                "log_snippet": "error: cannot install while Rust is installed (followed by 'warn: continuing ...')",
                "how_to_retrieve_logs": [
                    "gh run view 20764936549 --repo atomize-hq/substrate --log-failed | rg -n 'cannot install while Rust is installed|rustup'"
                ]
            },
            "proposed_fix": {
                "behavior": [
                    "Standardize runner provisioning: either rustup-only or system-Rust-only, but not mixed.",
                    "Make the workflow's toolchain step detect existing rustup and skip installation cleanly without surfacing an 'error:' line."
                ],
                "acceptance_criteria": [
                    "Runner logs contain no ignorable 'error:' lines from toolchain bootstrap",
                    "Toolchain step is deterministic across all self-hosted platforms"
                ]
            },
            "sources": [
                ".github/workflows/feature-smoke.yml"
            ]
        },
        {
            "id": "P3-008",
            "area": "Planning schema / platform semantics",
            "title": "Separate 'behavioral platform contract' from 'CI parity platforms' in planning packs",
            "status": "open",
            "problem": "WO0 was Linux-only behaviorally (ADR/spec) but required macOS/Windows CI parity; this mismatch created confusion about why macOS/Windows failures block the feature.",
            "evidence": {
                "behavioral_scope": [
                    "docs/project_management/next/ADR-0004-world-overlayfs-directory-enumeration-reliability.md (Linux-only changes; macOS/Windows out of scope)",
                    "docs/project_management/next/world-overlayfs-enumeration/WO0-spec.md (Linux-only contract)"
                ],
                "ci_parity_scope": [
                    "docs/project_management/next/world-overlayfs-enumeration/tasks.json meta.cross_platform=true and meta.platforms_required=[linux,macos,windows]",
                    "CI testing failure on macOS/Windows blocks completion (e.g., run 20763974819)"
                ]
            },
            "proposed_fix": {
                "behavior": [
                    "Introduce explicit fields (or conventions) distinguishing: (a) platforms with behavior guarantees vs (b) platforms required to be green in CI.",
                    "Ensure kickoff prompts and integration tasks explain this distinction and what 'green' means per platform (compile/test vs smoke behavior)."
                ],
                "acceptance_criteria": [
                    "Operators can tell at a glance whether a platform is required for runtime behavior or only for CI compile/test parity",
                    "Integration agents do not treat 'skip smoke on macOS/Windows' as 'macOS/Windows are irrelevant' when CI parity is required"
                ]
            },
            "sources": [
                "docs/project_management/next/world-overlayfs-enumeration/tasks.json",
                "docs/project_management/next/ADR-0004-world-overlayfs-directory-enumeration-reliability.md",
                "docs/project_management/next/world-overlayfs-enumeration/WO0-spec.md"
            ]
        },
        {
            "id": "P3-009",
            "area": "Cross-platform integration gate",
            "title": "Catch cross-platform compile breaks before Feature Smoke dispatch",
            "status": "completed",
            "problem": "Cross-platform compile errors in `crates/world` were only discovered after dispatching CI work, burning time on throwaway branches and (in other cases) self-hosted smoke runners before the failure signal was clear.",
            "evidence": {
                "ci_testing_run_id": "20763974819",
                "ci_testing_failed_oses": ["macos-14", "windows-2022"],
                "orchestration_log": "target/triad/orch-wrapper/WO0-ci-testing-pre-final.log",
                "how_to_retrieve_logs": [
                    "cat target/triad/orch-wrapper/WO0-ci-testing-pre-final.log",
                    "gh run view 20763974819 --repo atomize-hq/substrate --log-failed",
                    "gh run view 20763974819 --repo atomize-hq/substrate --log-failed | rg -n 'error\\[E0599\\]|mount_kernel_only|mount_fuse_only|error\\[E0277\\]|\\[u8\\]'"
                ],
                "compile_error_signals": [
                    "error[E0599]: no method named `mount_kernel_only` found for struct `overlayfs::OverlayFs`",
                    "error[E0599]: no method named `mount_fuse_only` found for struct `overlayfs::OverlayFs`",
                    "error[E0277]: the size for values of type `[u8]` cannot be known at compilation time"
                ]
            },
            "result": {
                "behavior": [
                    "Add an explicit cross-platform compile parity preflight step in `X-integ-core` before any Feature Smoke dispatch.",
                    "If compile parity fails, treat it as blocking and fix compile parity on the `X-integ-core` branch/worktree (cfg/platform guards), then re-run until green.",
                    "Make the wrapper orchestration flow enforce this preflight gate before it relies on smoke outcomes for platform selection."
                ],
                "docs_updated": [
                    "docs/project_management/standards/TRIAD_WORKFLOW_CROSS_PLATFORM_INTEG.md",
                    "docs/project_management/standards/TRIAD_INTEGRATION_WRAPPER_PROMPT.md",
                    "docs/project_management/standards/templates/kickoff_integ_core.md.tmpl"
                ]
            },
            "acceptance_criteria": [
                "For cross-platform features, `X-integ-core` runs cross-platform compile parity before Feature Smoke dispatch.",
                "If compile parity fails, smoke dispatch is not attempted until compile parity is green.",
                "Wrapper-driven integration runs stop early (with a clear remediation path) when compile parity fails."
            ],
            "sources": [
                "target/triad/orch-wrapper/WO0-ci-testing-pre-final.log",
                "docs/project_management/standards/TRIAD_WORKFLOW_CROSS_PLATFORM_INTEG.md",
                "docs/project_management/standards/TRIAD_INTEGRATION_WRAPPER_PROMPT.md",
                "docs/project_management/standards/templates/kickoff_integ_core.md.tmpl",
                "scripts/ci/dispatch_ci_testing.sh",
                ".github/workflows/ci-compile-parity.yml"
            ]
        }
    ]
}
